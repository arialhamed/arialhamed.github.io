---
title: "Arial's repository explorer"
permalink: /resources/explore-my-repos/
redirect_from:
 - /resources/explore-my-repos
 - /resources/explore-repos
 - /resources/explore-repos/
 - /resources/explore-ari-repos
 - /resources/explore-ari-repos/
 - /resources/explore
 - /resources/explore/
 - /explore-my-repos
 - /explore-my-repos/
 - /explore-repos
 - /explore-repos/
 - /explore
 - /explore/
 - /explorer
 - /explorer/
layout: default
prism: true
music-metadata: true
pdf: true
---

<div id="github-user-profile">
	<select id="select-branch" title="Select a branch"></select>
	<div style="clear: both;"></div>
</div>

<!-- title -->
<a id="current-title"></a>

<!-- description -->
<div>
	<span id="current-description"></span>
	<!-- <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="1.5em" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.32 6.176H5c-1.105 0-2 .949-2 2.118v10.588C3 20.052 3.895 21 5 21h11c1.105 0 2-.948 2-2.118v-7.75l-3.914 4.144A2.46 2.46 0 0 1 12.81 16l-2.681.568c-1.75.37-3.292-1.263-2.942-3.115l.536-2.839c.097-.512.335-.983.684-1.352l2.914-3.086Z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M19.846 4.318a2.148 2.148 0 0 0-.437-.692 2.014 2.014 0 0 0-.654-.463 1.92 1.92 0 0 0-1.544 0 2.014 2.014 0 0 0-.654.463l-.546.578 2.852 3.02.546-.579a2.14 2.14 0 0 0 .437-.692 2.244 2.244 0 0 0 0-1.635ZM17.45 8.721 14.597 5.7 9.82 10.76a.54.54 0 0 0-.137.27l-.536 2.84c-.07.37.239.696.588.622l2.682-.567a.492.492 0 0 0 .255-.145l4.778-5.06Z" clip-rule="evenodd"/></svg> -->
</div>

<!-- browsing controls -->
<div id="control-icons">
	<div>
		<a title="Back" id="explore-back"><svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12l4-4m-4 4 4 4"/></svg></a>
		<a title="Back to start" id="back-to-start"><svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 8 5 12 l4 4 M16 8 12 12 l4 4"/></svg></a>
		<a title="Refresh" id="explore-refresh" href="javascript:window.onhashchange()"><svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.7 7.7A7.1 7.1 0 0 0 5 10.8M18 4v4h-4m-7.7 8.3A7.1 7.1 0 0 0 19 13.2M6 20v-4h4"/></svg></a>
		<div id="search-field">
			<input type="search" onkeyup="searchContents()" onclick="searchContents()" id="search-input" placeholder="start typing here to search">
			<svg onclick="gId('search-input').value='';gId('search-input').focus();searchContents()" height="2em" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/></svg>
		</div>
	</div>
	<div>
		<div id="create-item">
			<a title="Create"><svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 7.757v8.486M7.757 12h8.486M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/></svg></a>
			<a title="New file" id="create-file"><svg height="0	" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-7Z" clip-rule="evenodd"/></svg></a>
			<a title="New folder" id="create-folder" href="javascript:createFolder()"><svg height="0	" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 8H4m8 3.5v5M9.5 14h5M4 6v13a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1h-5.032a1 1 0 0 1-.768-.36l-1.9-2.28a1 1 0 0 0-.768-.36H5a1 1 0 0 0-1 1Z"/></svg></a>
		</div>
		<a title="Upload here" id="upload-file" href="javascript:uploadFileInput.click()"><svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v9m-5 0H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-2M8 9l4-5 4 5m1 8h.01"/></svg></a>
		<a title="View" id="browse-view" href="javascript:browseToggleView()"></a>
		<a title="Download as repository as .zip" id="download-repo" href="javascript:downloadRepo()"><svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V4M7 14H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-2m-1-5-4 5-4-5m9 8h.01"/></svg></a>
		<label title="Pin this toolbar" for="pin-explorer-nav" style="float:right">
			<svg id="pin-explorer-nav-unpinned" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm0 0v6M9.5 9A2.5 2.5 0 0 1 12 6.5"/></svg>
			<svg id="pin-explorer-nav-pinned" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M5 9a7 7 0 1 1 8 6.93V21a1 1 0 1 1-2 0v-5.07A7.001 7.001 0 0 1 5 9Zm5.94-1.06A1.5 1.5 0 0 1 12 7.5a1 1 0 1 0 0-2A3.5 3.5 0 0 0 8.5 9a1 1 0 0 0 2 0c0-.398.158-.78.44-1.06Z" clip-rule="evenodd"/></svg>
		</label><input id="pin-explorer-nav" type="checkbox" style="display:none">
		<div style="clear:both"></div>
	</div>
	<!-- <div style="clear: both"></div> -->
</div>

<!-- all cells -->
<div id="explore-content"></div> <!-- alternative: list-group -->
<br>

<!-- under the cells, displaying all except images already in cells -->
<div id="explore-display">
</div>

<script type="text/javascript" src="https://arialhamed.github.io/static/js/prism.js" integrity="sha384-TkqOrDmcqktJ9KyGrO8dvy+cgNGxL8213a+Gjn9NWdSDFzuO0qXUfUjOQkv+OQHB" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://arialhamed.github.io/static/js/remarkable.min.js" integrity="sha384-+mAd+2zwsGbkQclpQUYAzd2sn40qJt1XvZ/y1tb2ff1EP6GEZ77FW1qwSt50qvrs" crossorigin="anonymous"></script>
<style>
/* GitHub credits & login, and branch toggle */
#github-user-profile{cursor:default;font-size:70%;opacity:.65}
#github-auth{cursor:pointer}
#github-auth:hover{color:white}
#select-branch{
	max-width: 50%;
	text-align: center;
	float: right;
	color: var(--font-color);
	background-color: var(--nav-overlay);
	border-radius: 1em;
}
#select-branch:empty{visibility:hidden}

/* Title & description */
#current-title{
	text-decoration:underline;
	text-align:center;
	font-size:200%;
	font-weight:500;
	margin:.1em 1.5em;
	color:var(--font-color);
	display:flex;
	flex-direction:column;
	line-height:1.8em;
	white-space:nowrap;
	text-overflow:ellipsis;
	overflow:hidden;
}
#current-title:hover{color:var(--anchor-color)}
#current-description{margin-top:.5em;/*Repository description*/}
#current-description svg{vertical-align:text-top;/*Private & fork icons*/}
#current-description + svg{float:right;/*Edit description icon*/}

/* Explorer control icons & search */
#control-icons{
	position:static;
	top:0;
	padding:.5em 0;
	background-color:var(--background-solid);
}
#control-icons > div{
	text-align:center;
	border-radius:3em;
}
#control-icons a{border-radius:.75em;fill:var(--anchor-color)}
#control-icons a:hover{/*background-color:var(--overlay-hover);*/color:var(--nav-font-color)}
#control-icons label > svg{color:var(--anchor-color)}
#control-icons label:hover > svg{color:var(--nav-font-color)}
#control-icons:has(#pin-explorer-nav:checked){position:sticky}
#control-icons:has(#pin-explorer-nav:not(:checked)) #pin-explorer-nav-pinned{display:none/*Hide pinned icon when unpinned*/}
#control-icons:has(#pin-explorer-nav:checked) #pin-explorer-nav-unpinned{display:none/*Hide unpinned icon when pinned*/}
#explore-back{float:left}#back-to-start{float:left}#upload-file{margin-left:2.5em;float:left}#explore-refresh{float:left}
#create-item{display:flex;position:absolute;flex-direction:column;border-radius:1.25em;float:left}#download-repo{float:right}#browse-view{float:right}
/* #create-item *{padding-bottom:.5em;} */
#create-item > *:not(:first-child) > svg{height:0}
#create-item:hover{background-color:var(--nav-overlay);box-shadow:inset 0 0 0 1px var(--anchor-color)}
#create-item:hover > *{display:block;padding-bottom:.5em}
#create-item:hover > * > svg{height:2.5em}
#create-item + div > *{padding-top:.5em}
#explore-back[href=''],#explore-back[href='']+#back-to-start{pointer-events:none;color:var(--anchor-color-hover);/*Disable if at all-repo view*/}
#explore-refresh svg:hover{rotate:180deg}
#search-field{
	display: flex;
	height: 2.5em;
	/* margin-bottom: .5em; */
	background-color: rgba(0,0,0,0.2);
	border-radius: 8px;
}
#search-field svg{/*Cancel icon*/
	padding: .3em;
	cursor: pointer;
	height: inherit;
	color: var(--anchor-color)
}
#search-field svg:hover{color:var(--font-color)}
#search-input{
	width: 100%;
	height: inherit;
	background-color: transparent;
	color: var(--font-color);
	border-width: 0px;
	padding: .2em 0 .3em .5em;
}

/* Explorer content & items within */
:has(>:nth-child(2)) > .loader{display:none;/*Hide when there are at least 2 items in #explore-content or show-* (i.e. if .loader is not alone)*/}
#explore-content > .loader{margin:2em auto;grid-column:1 / 5;/*"rowspan" for grid display*/}
#explore-content img{/*Only explore-content image descendants*/max-width:100%;margin:auto}
#explore-content > a{padding:.3em}
.explore-cell:hover{background-color:var(--overlay-hover)}
.explore-cell{
	display: inline-block;
	color: var(--anchor-color-solid) !important;
	text-decoration: none;
	background-color: var(--overlay);
	-webkit-user-select: none;
	-moz-user-select: none;
	user-select: none;
	font-size: 1rem;
}
span.explore-cell{cursor: pointer}
.grid{display:grid;grid-template-columns:25% 25% 25% 25%;}
.grid .explore-cell{text-align:center;/*padding:.375rem .75rem;*/margin:4px;}
.grid .explore-cell span:nth-child(2){font-size:70%;}
.grid .explore-cell span:nth-child(2):not(.size){display:none;}
.grid .explore-cell:has(img){display:flex}
.list-group .explore-cell{text-align:left;padding:.2rem .5rem;margin:2.5px 0;display:flex;}
.list-group .explore-cell:not(:has(img)) span:nth-child(2){font-size:70%;text-align:right;max-width:fit-content;/*Datetime in all-repo view*/}
.list-group .explore-cell:has(img){display:block;width:100%;padding:.5em}
.list-group .explore-cell:has(img) span{text-align:center;margin-top:.5em}
.list-group .explore-cell img{width:100%;}
.explore-cell *{margin: 0 auto;}
.explore-cell span{
	overflow: hidden;
	text-overflow: ellipsis;
	width: 100%;
	display: block;
}
.row .explore-cell img{
	max-width: initial;
	height: calc(min(15vh, 20vw) - .75rem);
}
.list-group .explore-cell span svg{ /* Private & fork icons */
	margin-left: .3em
}

/* Specific file styles when chosen to display */
#md-parsed{
	text-align: initial;
	/* left: clamp(.75rem, calc(50vw - 400px), 24%); */
	position: inherit;
	display: block;
	/* width: min(calc(var(--inner-width) - 1.75rem), 98vw - 1.5rem); */
	padding: 1rem;
	background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' stroke='grey' stroke-width='2' stroke-dasharray='40%2c 10' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
	max-width: calc(var(--inner-width) - 20px);
	margin: 0 auto;
}
#show-image{
	max-width: 100%;
	max-height: calc(100% - 10vh);
	object-fit: contain;
	margin: auto;
}
#show-audio{
	width: 90%;
	accent-color: var(--anchor-color);
}
#show-pdf{min-height:65vh;display:flex;flex-direction:column}
#show-pdf img{max-width:100%}
.explore-display-image #explore-display span:first-child{ 
	background-color: var(--popup-background-color);
	padding: 1em;
	border-radius: 2em;
}
.explore-display-default{
	display: block;
	float: none; 
	text-align: center; 
	padding: 12px 0; 
}
.explore-display-image{
	display: flex;
	flex-direction: column;
	text-align: center; 
	position: fixed; 
	padding: 5vh 5vw; 
	top: 0; 
	bottom: 0; 
	left: 0; 
	right: 0;
	background-color: var(--popup-background-color); 
	width: 100%; 
	height: 100%; 
	z-index: 6; 
	margin: 0;
}
.explore-display-audio{
	display: block;
	text-align: center;
	position: sticky;
	position: -webkit-sticky;
	padding: 1em;
	bottom: 1em;
	background-color: #0007;
	background-image: url("");
	background-size: auto 100%;
	background-repeat: no-repeat;
	background-blend-mode: overlay;
	width: calc(100% - 2em);
	z-index: 4;
	border-radius: 2em;
	margin: auto;
}
#explore-display-close:hover{transform: rotate(180deg) scale(1.5)}
#explore-display-close{
	float: right;
	cursor: pointer;
	width: 3em;
}
.explore-display-image #explore-display-close{
	top: unset;
	left: 1.5em;
	/* bottom: -1.5em; */
}
.explore-display-audio #explore-display-close{
	top: -.2em;
	right: -.5em;
}
#explore-display-close + a{
	font-size: 175%;
	position: relative;
	word-wrap: anywhere;
}
.explore-display-image #explore-display-close + a{width:calc(100% - 3em);display:block}
.explore-display-audio #explore-display-close + a{left:0;padding:.4em;border-radius:.75em;-webkit-box-decoration-break:clone;-o-box-decoration-break:clone;box-decoration-break:clone}

/* Audio specific controls */
#audio-controls{display:flex;height:6em}
#audio-controls svg{cursor:pointer}
#audio-controls span{font-family:var(--bs-font-monospace);font-size:1.2em;line-height:1em;margin-top:1em}
#audio-controls *:first-child{margin:auto;margin-right:0}
#audio-controls *:last-child{margin:auto;margin-left:0}
#audio-controls svg{transition:all .1s}
#audio-controls svg:hover{transform:scale(1.1)}
#audio-controls svg:active{transform:scale(.9)}
#audio-decrease, #audio-increase{height:60%}
#audio-increase{margin-left:.25em}
#audio-volume{display:inline}
#audio-volume div{display:flex;flex-direction:row}
#audio-volume div *{margin:auto;width:2em}
#audio-music{width:3em}
</style>
<script>

// Third-party library objects
const mdConverter=new remarkable.Remarkable({html: true}); // Parse markdown text
const modules = {}

// Constants
const extV=['.webm','.mp4','.mov','.wmv','.avi','.flv','.swf','.mkv','.webm'];
const extS=['.3gp','.aa','.aac','.aax','.act','.aiff','.alac','.m4a','.amr','.ape','.au','.awb','.dss','.dvf','.flac','.gsm','.iklax','.ivs','.m4b','.m4p','.mmf','.movpkg','.mp3','.mpc','.msv','.nmf','.ogg','.opus','.ra','.raw','.rf64','.tta','.voc','.vox','.wav','.wma','.wv','.8svx','.cda','.oga','.mogg','.rm'];
const extA=['.7z','.zip','.apk','.apks','.xapk','.arc','.ark','.jar','.zpaq','.zip','.tar.gz','.tar.bz2','.tgz','.rar','.wad','.pk3','.exe'];
const ext3=['.3mf','.stl','.glb','.gltf','.obj','.amf'];
const extI=['.avif','.gif','.jpg','.jpeg','.jfif','.pjpeg','.pjp','.png','.svg','.webp','.bmp','.ico','.cur','.tif','.tiff','.kra','.jpg_large'];
const extR=['.csv','.tsv','.xlsx'];
const iconCopy=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M18 3a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1V9a4 4 0 0 0-4-4h-3a2 2 0 0 0-1 .3V5c0-1.1.9-2 2-2h7Z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M8 7v4H4.2c0-.2.2-.3.3-.4l2.4-2.9A2 2 0 0 1 8 7.1Zm2 0v4a2 2 0 0 1-2 2H4v6c0 1.1.9 2 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3Z" clip-rule="evenodd"/></svg>`;
const audioPlayer=new Audio();
audioPlayer.shuffle=false;
audioPlayer.loop=true;
audioPlayer.togglePlay=function(){this.paused?this.play():this.pause()}
audioPlayer.volumeAdd=function(f=0){this.volume=clamp(0,this.volume+f,1)}
const pathPaused=`<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 18V6l8 6-8 6Z"/>`
const pathPlaying=`<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 6H8a1 1 0 0 0-1 1v10c0 .6.4 1 1 1h1c.6 0 1-.4 1-1V7c0-.6-.4-1-1-1Zm7 0h-1a1 1 0 0 0-1 1v10c0 .6.4 1 1 1h1c.6 0 1-.4 1-1V7c0-.6-.4-1-1-1Z"/>`
const privateIcon=`<svg title="This repository is private" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="1em" fill="currentColor" viewBox="0 0 24 24"> <path fill-rule="evenodd" d="M8 10V7a4 4 0 1 1 8 0v3h1a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h1Zm2-3a2 2 0 1 1 4 0v3h-4V7Zm2 6a1 1 0 0 1 1 1v3a1 1 0 1 1-2 0v-3a1 1 0 0 1 1-1Z" clip-rule="evenodd"/></svg>`
const forkIcon=`<svg title="This repository is a fork" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="1em" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M5 6a3 3 0 1 1 4 2.83V10a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V8.83a3.001 3.001 0 1 1 2 0V10a3 3 0 0 1-3 3h-1v2.17a3.001 3.001 0 1 1-2 0V13h-1a3 3 0 0 1-3-3V8.83A3.001 3.001 0 0 1 5 6Z" clip-rule="evenodd"/></svg>`
const audioPlayerHTML=`
<div id="audio-controls">
	<span id="audio-duration">--:--<br>-<br>--:--</span>
	<svg id="audio-previous" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M7 6a1 1 0 0 1 2 0v4l6.4-4.8A1 1 0 0 1 17 6v12a1 1 0 0 1-1.6.8L9 14v4a1 1 0 1 1-2 0V6Z" clip-rule="evenodd"/></svg>
	<svg id="audio-toggle" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">${pathPaused}</svg>
	<svg id="audio-next" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M17 6a1 1 0 1 0-2 0v4L8.6 5.2A1 1 0 0 0 7 6v12a1 1 0 0 0 1.6.8L15 14v4a1 1 0 1 0 2 0V6Z" clip-rule="evenodd"/></svg>
	<div id="audio-volume">
		<div>
			<svg id="audio-decrease" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.5 8.4a5 5 0 0 1 0 7.1M14 6.1V18a1 1 0 0 1-1.6.7L8 15H6a1 1 0 0 1-1-1v-4c0-.6.4-1 1-1h2l4.4-3.6A1 1 0 0 1 14 6Z"/></svg>			
			<span id="audio-volume-num">--</span>
			<svg id="audio-increase" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.5 8.4a5 5 0 0 1 0 7.1m2.9 2.9a9 9 0 0 0 0-12.8m-6.4.5V18a1 1 0 0 1-1.6.7L6 15H4a1 1 0 0 1-1-1v-4c0-.6.4-1 1-1h2l4.4-3.6A1 1 0 0 1 12 6Z"/></svg>
		</div>
	</div>
	<div id="audio-music">
		<svg id="audio-music-shuffle" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 9.2 15 7h5m0 0-3-3m3 3-3 3M4 17h4l1.6-2.3M4 7h4l7 10h5m0 0-3 3m3-3-3-3"/></svg>
		<svg id="audio-music-loop" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m16 4 3 3H5v3m3 10-3-3h14v-3m-9-2.5 2-1.5v4"/></svg>
	</div>
</div>
<input id="show-audio" value="0" type="range">`;
const viewIcon = `<svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M9 8h10M9 12h10M9 16h10M4.99 8H5m-.02 4h.01m0 4H5"/></svg>`
const viewList = `<svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.143 4H4.857A.857.857 0 0 0 4 4.857v4.286c0 .473.384.857.857.857h4.286A.857.857 0 0 0 10 9.143V4.857A.857.857 0 0 0 9.143 4Zm10 0h-4.286a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286A.857.857 0 0 0 20 9.143V4.857A.857.857 0 0 0 19.143 4Zm-10 10H4.857a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286a.857.857 0 0 0 .857-.857v-4.286A.857.857 0 0 0 9.143 14Zm10 0h-4.286a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286a.857.857 0 0 0 .857-.857v-4.286a.857.857 0 0 0-.857-.857Z"/></svg>`
const uploadFileInput=Object.assign(document.createElement('input'), {type:'file',multiple:true});

// Browsing control variables
let debog;
let browsingTree=[];
let mediaArray=[];
let mediaArrayRandom=[];
let mediaArrayLocation='';
let browsingCurrentRepo='';
let ghusr='arialhamed';
let intervalsDict={};

// The following will read each file or content (or repos) and display into the explore-content element
const addObjectToView=e=>{
	let contentElement='<a class="col explore-cell"';
	if (e.git_url.startsWith('git://')){ // Is the record from the start?
		// Adds the repository names and the prospective API URLs as cells
		gId('explore-content').insertAdjacentHTML('beforeend', `${contentElement} href="#${e.url.slice(22)}/contents?ref=${e.default_branch}" data-search="${e.name}"><span>${e.name}${e.private?privateIcon:''}${e.fork?forkIcon:''}</span><span>${new Date(e.pushed_at).toLocaleDateString(navigator.languages[0],{year:'numeric',month:'short',day:'numeric',hour:'numeric',minute:'numeric',second:'numeric'})}</span></a>`);
	}else{
		// Is the record a directory?
		if (e.type == 'dir'){
			contentElement+=` href="#${e.url.slice(22)}" id="${e.sha}" data-search="${e.name}")><span>${e.name}</span><svg height="1.2em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 6c0-1.1.9-2 2-2h5.5a2 2 0 0 1 1.6.7L14 7H3V6Zm0 3v10c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V9H3Z" clip-rule="evenodd"/></svg></a>`;
		}else{
			// This record is a file in these brackets
			let showItemElement=` onclick="showFile('${e.download_url.replace(/'/g, '%27')}', '${e.git_url}')" data-search="${e.name}"`;
			// Is the record an image?
			if (extI.some(v => e.download_url.split('?',1)[0].toLowerCase().endsWith(v))){ 
				contentElement = `<span class="col explore-cell"${showItemElement}><img src="${e.download_url}" alt="${e.name}" /><span><a href="${e.download_url}">${e.name}</a></span></span>`;
			}else{
				contentElement += `${showItemElement}><span>${e.name}</span><span class="size">${formatBytes(e.size)}</a>`;
			}
			mediaArray.push([e.download_url, e.git_url]);
			mediaArrayRandom.splice((mediaArrayRandom.length+1)*Math.random()|0,0,[e.download_url, e.git_url])
		}

		// Adds the folders and files as cells
		gId('explore-content').insertAdjacentHTML('beforeend', contentElement);
	}
}

// The following will get the contents from GitHub API, then add processes it, then loops whatever array there is using addObjectToView
// 'refresh' boolean is to reload private repo's download_url tokens
window.onhashchange=async()=>{
	const inUrl = window.location.hash.slice(1);
	const isReload = inUrl==browsingTree.at(-1); // Only encountered when just running window.onhashchange() alone without changing browsingTree & 

	if(isReload){browsingTree.pop();console.log('refreshing')};
	browsingTree.at(-2)==inUrl?browsingTree.pop():browsingTree.push(inUrl);

	// mediaArray=[];
	gId('explore-content').innerHTML='<span class="loader" data-search=""></span>';

	try{
		// Get repository contents or list repositories of a user
		browseJson=await fetch(`https://api.github.com${inUrl}`, github_api_headers({refresh: isReload})).then(r=>r.json());
		if (inUrl.startsWith(`/users/${ghusr}/repos`)){ // If current link is the start
			browsingTree=[inUrl]
			gId('explore-back').href='';
			gId('current-title').textContent='My GitHub repositories';
			gId('current-title').removeAttribute('href');
			gId('current-description').innerHTML=`<i>&lt;description will be shown here when you select a repository below&gt;</i>`;
			// gId('upload-file').style.visibility='hidden'; // Hide upload button
			// gId('download-repo').style.visibility='hidden'; // Hide download button
			browsingCurrentRepo = '' // Reset value as we are not in a repo here
			gId('select-branch').innerHTML=''

			if(github_token){
				const privateRepos=await fetch('https://api.github.com/user/repos?per_page=100&visibility=private',github_api_headers({refresh: isReload})).then(r=>r.json()).then(j=>j.filter(v=>v.owner.login==ghusr))
				browseJson.push(...privateRepos)
			}
			browseJson.sort((a,b)=>b['pushed_at'].localeCompare(a['pushed_at']))
		}else{ // If repository selected or in contents of repository (not at the start of the page)
			gId('explore-back').href=`#${browsingTree.at(-2)}`
			// if(github_token)gId('upload-file').style.visibility='visible'; // Show upload button for authenticated users
			gId('download-repo').style.visibility='visible'; // Show download button

			// Get repository of current URL, regardless where you are (format is `{user}/{repository}`)
			const rrCurrent = inUrl.split('/').slice(2,4).join('/')

			// If we are changing from all-repo view to a repo, run this once.
			if (browsingCurrentRepo!=rrCurrent){ // If the browsing repo does not match the current repo
				browsingCurrentRepo=rrCurrent

				// Set title & description of current repo
				const rrDeets = await fetch(`https://api.github.com/repos/${browsingCurrentRepo}`, github_api_headers({refresh: isReload})).then(r=>{if(!r.ok){throw r}return r.json()})
				gId('current-description').innerHTML=`${rrDeets.private?privateIcon:''}${rrDeets.fork?`<a href="${rrDeets.parent.html_url}">${forkIcon}</a>`:''}${rrDeets.description===null?'<i>No description</i>':rrDeets.description}`;
				gId('current-title').textContent=rrDeets.name;
				gId('current-title').href=rrDeets.html_url

				// Set branch choices
				const branches = await fetch(`https://api.github.com/repos/${browsingCurrentRepo}/branches`, github_api_headers({refresh: isReload})).then(r=>r.json())
				gId('select-branch').innerHTML=branches.map(v=>`<option value=\"${v.name}\"${inUrl.endsWith(v.name)?'selected':''}>${v.name}</option>`).join('')
			}

			// Sometimes, a repository will just be empty (no commits) so there are no files to sort and build the view
			if(browseJson.status=='404'){
				gId('explore-content').insertAdjacentHTML('beforeend', `<span id="repo-is-empty" style="text-align:center;font-size:200%;padding:2em;font-style:italic;">${browseJson.message}</span>`);return
			}else{ // At this point, we are inside a repository with commits, so let's put the folders first
				browseJson.sort((a, b) => a.type.localeCompare(b.type))
			}
		}
		console.log(browsingTree);

		// Loops through each... whatever thing. He needs some milk
		browseJson.forEach(addObjectToView)
		searchContents()
	}catch(err){
		gId('explore-back').href='';
		gId('current-description').innerHTML='';
		gId('current-title').textContent='Uh oh, that URL is invalid';
		gId('explore-content').innerHTML=`<a style="text-align:center;font-size:200%;margin:2em;" href="#/users/${ghusr}/repos?per_page=100&sort=pushed">Return to repositories view?</a>`;
		return
	}
}
const downloadFile=async(inUrl)=>{
	const fileDetails = await fetch(`https://api.github.com${inUrl}`, github_api_headers()).then(r=>r.json())
	fetch(fileDetails.git_url, github_api_headers({raw: true}))
	.then(r=>r.blob())
	.then(b=>Object.assign(document.createElement('a'),{href:window.URL.createObjectURL(b),download:fileDetails.name}).click())
	.then(f=>console.log(`"${fileDetails.name}" has been downloaded`))
	// const xhr = new XMLHttpRequest();
	// xhr.progress=e=>console.log(e.loaded/fileDetails.size);
	// xhr.open('GET', fileDetails.git_url)
	// xhr.setRequestHeader('Accept', `application/vnd.github.v3+json`)
	// xhr.setRequestHeader('Authorization', (github_token)?`token ${github_token}`:``)
	// xhr.send()
	// console.log("what")
}

// When click on file, show it. Exceptions for markdown files.
async function showFile(downloadUrl, gitUrl, mdRaw=false, audioCont=false){
	console.log(`showFile(${downloadUrl}, ${gitUrl})`);
	const bDisplay=gId('explore-display');
	var fileName=downloadUrl.split('/').pop().split('?')[0];

	// Remove loops to avoid raiding the console section 
	if(audioMainLoop)clearInterval(audioMainLoop);

	// Builds 2 elements, the first one is the close button, X, and the second one is the name of the file, and also
	const [locationId, refId] = window.location.hash.slice(1).split('?ref=')
	let browseDisplayInner=`<div>
	<svg id="explore-display-close" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 9-6 6m0-6 6 6m6-3a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/></svg>
	<a href="${downloadUrl.includes('?token=')?`javascript:downloadFile('${locationId}/${fileName}?ref=${refId}')`:downloadUrl}">${decodeURIComponent(fileName)}</a>
	</div>`;
	// If we are in a private repo, the 'downloadUrl' will have '?token=' appended to it. That's only temporary.

	// Add option to show parsed for markdown files
	if (fileName.toLowerCase().endsWith('.md')){browseDisplayInner+=` <span style="cursor:pointer;position:relative;left:3em;">(<a onclick="showFile('${downloadUrl}', '${gitUrl}', ${(mdRaw?'false)">alt: parsed':'true)">alt: raw')}</a>)</span>`}

	// Remove any existing browsing indicators from explore-display
	['default', 'image', 'audio'].forEach(a => bDisplay.classList.remove('explore-display-'+a))
	let browseDisplayIndicator='default';

	if(extI.some(v => fileName.toLowerCase().endsWith(v))){
		if(gId('explore-content').classList[0]=='list-group'){return} // Images are already quite maximized when explore-content is in list-group mode, so not required here
		browseDisplayIndicator="image";
		browseDisplayInner=`<img id="show-image" src="${downloadUrl}"><span>${browseDisplayInner}</span>`;
	}else if(extV.some(v => fileName.toLowerCase().endsWith(v))){
		browseDisplayInner+=`<video id="show-video" style="width: 100%;" controls><source src="${downloadUrl}" type="video/webm"></video>`;
	}else if(extS.some(v => fileName.toLowerCase().endsWith(v))){
		browseDisplayIndicator="audio";
		browseDisplayInner+=audioPlayerHTML;
	}else if(ext3.some(v => fileName.toLowerCase().endsWith(v))){
		browseDisplayInner+=`<model-viewer alt="${decodeURIComponent(downloadUrl.substring(downloadUrl.lastIndexOf('/')+1))}" src="${downloadUrl}" shadow-intensity="1" camera-controls touch-action="pan-y"></model-viewer>`;
	}else if(extA.some(v => fileName.toLowerCase().endsWith(v))){
		browseDisplayInner+="<p>Contents of this file can not be parsed here.</p>";
	}else if(fileName.toLowerCase().endsWith(".pdf")){
		browseDisplayInner+=`<br><div id="show-pdf"><span class="loader"></span></div>`
	}else{
		const itemTextOut=await fetch(gitUrl, github_api_headers()).then(r=>r.json()).then(t=>atob(t['content']));

		// If asked to shown parsed (mdRaw=false), and file is markdown, then parse the file contents with Showdown.js and display it
		if(fileName.toLowerCase().endsWith('.md') && !mdRaw){
			browseDisplayInner+=`<br><span id="md-parsed">${mdConverter.render(itemTextOut.substring(1).split('---').pop())}</span>`;
		}else{ // else show it parsed in Prism.js
			browseDisplayInner+=`<br><pre style="background-color:#333a;/*width:100%;*/" data-src="${downloadUrl}" data-download-link><code id="show-text" class="line-numbers language-${fileName.split('.').pop()}">${itemTextOut.replace(/\</g, '&lt;')}</code></pre>`;
		} // The code `itemTextOut.replace(/\</g, "&lt;")` replaces all `<` symbols with the escaped version, due to a HTML issue with the pre element
	}

	// Clear inline styles, push contents to explore-display's innerHTML, and add custom-by-file styles via class
	bDisplay.style='';
	bDisplay.innerHTML=browseDisplayInner;
	bDisplay.classList.add('explore-display-'+browseDisplayIndicator);
	gId('explore-display-close').onclick=()=>{
		bDisplay.innerHTML='';
		bDisplay.classList.remove('explore-display-'+browseDisplayIndicator);
		['default','image','audio'].forEach(e=>{bDisplay.classList.remove('explore-display-'+e)})
	}

	// Automatically scroll down
	if(!['image','audio'].includes(browseDisplayIndicator)){window.scrollTo({top: gId('explore-display').getBoundingClientRect().y+window.pageYOffset, behavior: "smooth"})}

	// Set volume to half and play the media automatically
	if (gId('show-video')!==null){gId('show-video').volume=.5;gId('show-video').play()}
	if (gId('show-text')!==null){Prism.highlightElement(gId('show-text'))}
	if (gId('show-pdf')!==null){
		let pdf = await fetch(gitUrl, github_api_headers({raw:true}))
		.then(r=>r.arrayBuffer())
		.then(pdfData=>pdfjsLib.getDocument({data: pdfData}).promise)
		const getSinglePage=async(pageNumber)=>{
			pdf.getPage(pageNumber).then(page=>{
				let viewport = page.getViewport({scale: 4});
				let canvas = document.createElement('canvas');
				let context = canvas.getContext('2d');
				canvas.height = viewport.height;
				canvas.width = viewport.width;

				// Render PDF page into canvas context
				let renderContext = {
					canvasContext: context,
					viewport: viewport
				};
				// let renderTask = page.render(renderContext);
				page.render(renderContext).promise.then(()=>{
					gId('show-pdf').insertAdjacentHTML('beforeend', `<img src="${canvas.toDataURL()}">`)
					if(pdf.numPages>pageNumber)getSinglePage(pageNumber+1);
				})
			})
		}
		getSinglePage(1)
	}
	if (gId('show-audio')!==null){
		console.log('Playing audio')
		function aPnext(){var queue=audioPlayer.shuffle?mediaArrayRandom:mediaArray;showFile.apply(this,queue[queue.findIndex(x=>x[0]==downloadUrl)==queue.length-1?0:queue.findIndex(x=>x[0]==downloadUrl)+1])}
		function aPprevious(){var queue=audioPlayer.shuffle?mediaArrayRandom:mediaArray;showFile.apply(this,queue[queue.findIndex(x=>x[0]==downloadUrl)==0?queue.length-1:queue.findIndex(x=>x[0]==downloadUrl)-1])}

		const volVal=Object.assign(document.createElement('input'), {id:'audio-volume-value',type:'range',value:audioPlayer.volume*100,max:100});
		gId('audio-volume').insertAdjacentElement('afterbegin',volVal)

		const aToggle=gId('audio-toggle');
		var audioMainLoop=setInterval(()=>{
			gId('show-audio').value=audioPlayer.currentTime*8;
			gId('audio-duration').innerHTML=new Date(audioPlayer.currentTime*1000).toISOString().slice(14, 19)+'<br>-<br>'+new Date((isNaN(audioPlayer.duration)?0:audioPlayer.duration)*1000).toISOString().slice(14, 19);
			gId('audio-volume-num').innerHTML=parseInt(audioPlayer.volume*100)
			volVal.value=audioPlayer.volume*100;

		}, 125)
		gId('explore-display-close').addEventListener('click',()=>{
			ogilvie.src='';
			window.onkeydown=()=>{};
			audioPlayer.pause()
			audioMainLoop?clearInterval(audioMainLoop):'';
			bDisplay.classList.remove('disable-selection')
		})

		bDisplay.classList.add('disable-selection');

		URL.revokeObjectURL(audioPlayer.src);
		audioPlayer.src = '';
		fetch(gitUrl, github_api_headers({raw: true}))
		.then(r=>r.blob())
		.then(b=>{
			audioPlayer.src = URL.createObjectURL(b);
			return modules.parseBlob(b);
		})
		.then(m=>{
			debog=m;
			ogilvie.src=(m.common.picture==null)?'':embeddedImgToURI(m.common.picture[0])
		})

		// debugger;
		// const mediaSource = new MediaSource();
		// audioPlayer.src = URL.createObjectURL(mediaSource);
		// mediaSource.addEventListener('sourceopen', async ()=>{
		// 	const response = await fetch(gitUrl, github_api_headers({raw: true}))
		// 	console.log(`response: ${response}`)
		// 	const reader = response.body.getReader();
		// 	console.log(`reader: ${reader}`)
		// 	const mimeType = 'audio/flac' //response.headers.get('Content-Type');
		// 	console.log(`mimeType: ${mimeType}`)
		// 	const sourceBuffer = mediaSource.addSourceBuffer(mimeType);
		// 	console.log(`sourceBuffer: ${sourceBuffer}`)
		// 	let isFirstChunk = true;
		// 	while (true) {
		// 		const { done, value } = await reader.read()
		// 		if (done) {
		// 			sourceBuffer.endOfStream();
		// 			break;
		// 		};
		// 		sourceBuffer.appendBuffer(value);
		// 		if (isFirstChunk) {
		// 			audioPlayer.play().catch(error=>console.error("Error playing audio:", error));
		// 			isFirstChunk = false;
		// 		}
		// 	}
		// 	response.blob()
		// 	.then(b=>modules.parseBlob(b))
		// 	.then(m=>{
		// 		debog=m;
		// 		ogilvie.src=(m.common.picture==null)?'':embeddedImgToURI(m.common.picture[0])
		// 	})
		// })

		audioPlayer.onloadstart=()=>{ogilvie.src=''}
		audioPlayer.onloadedmetadata=function(){
			this.play();
			gId('show-audio').max=this.duration*8;
		}
		audioPlayer.onended=function(){!audioPlayer.loop?aPnext():''}

		gId('show-audio').oninput=function(){audioPlayer.currentTime=this.value/8} // Slider change current time
		aToggle.onclick=()=>{audioPlayer.togglePlay()} // Play/Paused toggle
		audioPlayer.onplay=()=>{aToggle.innerHTML=pathPlaying}; audioPlayer.onpause=()=>{aToggle.innerHTML=pathPaused} // Play/Paused display
		volVal.oninput=function(){audioPlayer.volume=this.value/100} // Slider change volume
		gId('audio-next').onclick=()=>{aPnext()}
		gId('audio-previous').onclick=()=>{aPprevious()}
		[['in',.01],['de',-.01]].forEach(e=>{gId('audio-'+e[0]+'crease').onclick=()=>{audioPlayer.volumeAdd(e[1])}})

		window.onkeydown=function(){
			// catches anything that does not require text input
			if(!(('color|date|datetime-local|email|month|number|password|search|tel|text|time|url|week'.includes(document.activeElement.type)&&document.activeElement.tagName==='INPUT')||document.activeElement.tagName==='TEXTAREA')){
				keyCodeUnassigned=true;
				switch(this.keyCode){
					case 74: case 37: audioPlayer.currentTime -= 3; break;
					case 75: case 32: audioPlayer.togglePlay(); break;
					case 76: case 39: audioPlayer.currentTime+=3; break;
					case 38: audioPlayer.volumeAdd(.01); break;
					case 40: audioPlayer.volumeAdd(-.01); break;
					default: keyCodeUnassigned=false
				}
				if(keyCodeUnassigned)this.preventDefault();
			}
		}
		gId('audio-volume').onwheel=e=>{e.preventDefault();audioPlayer.volumeAdd(Math.max(e.deltaX,-e.deltaY)>0?-.01:.01)}
		gId('show-audio').onwheel=e=>{e.preventDefault();audioPlayer.currentTime=clamp(0,audioPlayer.currentTime+(Math.max(e.deltaX,-e.deltaY)>0?-1:1),audioPlayer.duration)}
		gId('audio-music-shuffle').style.color=audioPlayer.shuffle?'var(--anchor-color)':'var(--font-color)';
		gId('audio-music-shuffle').onclick=function(){audioPlayer.shuffle=!audioPlayer.shuffle;this.style.color=audioPlayer.shuffle?'var(--anchor-color)':'var(--font-color)'}
		gId('audio-music-loop').style.color=audioPlayer.loop?'var(--anchor-color)':'var(--font-color)';
		gId('audio-music-loop').onclick=function(){audioPlayer.loop=!audioPlayer.loop;this.style.color=audioPlayer.loop?'var(--anchor-color)':'var(--font-color)'};

	}
}
uploadFileInput.onchange=async(e)=>{
	let [locationId, refId] = window.location.hash.slice(1).split('?ref=');
	const apiUrl = `https://api.github.com/repos/${browsingCurrentRepo}/git`;

	// 1. Process picked files
	let files = await Promise.all(Array.from(e.target.files).map(file=>{
		let reader=new FileReader();
		return new Promise(resolve=>{
			reader.onload=()=>resolve({path:`${locationId.slice(17+browsingCurrentRepo.length)}/${file.name}`,content:reader.result});
			reader.readAsDataURL(file)
		})
	}))

	let commitMessage = `Uploaded ${gasoline.length} file(s)`
	
	// 2. Get the latest commit reference
	const refResponse = await fetch(`${apiUrl}/refs/heads/${refId}`, {headers: {Authorization: `token ${github_token}`}});
	const refData = await refResponse.json();
	const latestCommitSha = refData.object.sha;

	// 3. Create blobs for each file
	const blobPromises = files.map(file =>
		fetch(`${apiUrl}/blobs`, {
			method: 'POST',
			headers: {Authorization: `token ${github_token}`},
			body: JSON.stringify({
				content: file.content.split(';base64,')[1],
				encoding: 'utf-8'
			})
		}).then(res => res.json())
	);
	const blobData = await Promise.all(blobPromises);

	// 4. Create the tree
	const treeItems = blobData.map((blob, index) => ({
		path: files[index].path,
		mode: '100644',
		type: 'blob',
		sha: blob.sha
	}));
	const treeResponse = await fetch(`${apiUrl}/trees`, {
		method: 'POST',
		headers: {Authorization: `token ${github_token}`},
		body: JSON.stringify({
			base_tree: latestCommitSha,
			tree: treeItems
		})
	});
	const treeData = await treeResponse.json();

	// 5. Create the commit
	const commitResponse = await fetch(`${apiUrl}/commits`, {
		method: 'POST',
		headers: {Authorization: `token ${github_token}`},
		body: JSON.stringify({
			message: commitMessage,
			tree: treeData.sha,
			parents: [latestCommitSha]
		})
	});
	const commitData = await commitResponse.json();

	// 6. Update the branch reference
	const updateRefResponse = await fetch(`${apiUrl}/refs/heads/${refId}`, {
		method: 'PATCH',
		headers: {Authorization: `token ${github_token}`},
		body: JSON.stringify({
			sha: commitData.sha
		})
	});

	if (updateRefResponse.ok) {
		console.log('Commit successful');
	} else {
		console.error('Error updating ref:', updateRefResponse.status, updateRefResponse.statusText);
	}
	// const intermediaryReader = new FileReader();
	// intermediaryReader.onloadend=()=>{
	// 	const uploadedFileURL = `https://api.github.com${locationId}/${e.target.files[0].name}?ref=${refId}`;
	// 	fetch(
	// 		uploadedFileURL, {
	// 		headers: {Authorization: `token ${github_token}`},
	// 		method: 'PUT',
	// 		body: JSON.stringify({
	// 			message: `Upload from "${window.location.hostname}" at "${new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric',hour:'numeric',minute:'numeric',second:'numeric'})}"`,
	// 			content: intermediaryReader.result.split(';base64,')[1]
	// 		})
	// 	})
	// // 	// .then(r=>gId('explore-refresh').click())
	// 	.then(r=>r.json())
	// 	.then(j=>{
	// 		// debog=j;
	// 		// gId('explore-refresh').click();
	// 		raiseToast(`"${j.content.name}" has been uploaded`)
	// 	})
	// }
	// // intermediaryReader.readAsDataURL(e.target.files[0])
	// const listOfFiles = Array.from(e.target.files);
	// listOfFiles.forEach(f=>intermediaryReader.readAsDataURL(f));
	gId('explore-refresh').click();
	raiseToast(`${files.length} file(s) has been uploaded`)
}
const createFolder=async()=>{
	let folderName = prompt('New folder name')
	if(folderName!=null){
		let [locationId, refId] = window.location.hash.slice(1).split('?ref=');
		let uploadedFileURL = `https://api.github.com${locationId}/${folderName}/.gitkeep?ref=${refId}`;
		fetch(
			uploadedFileURL, {
			headers: {Authorization: `token ${github_token}`},
			method: 'PUT',
			body: JSON.stringify({
				message: `Create this folder from "${window.location.hostname}" at "${new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric',hour:'numeric',minute:'numeric',second:'numeric'})}"`,
				content: ''
			})
		})
		// .then(r=>r.json())
		.then(j=>{
			gId('explore-refresh').click();
			raiseToast(`"${folderName}" folder has been created`)
		})
	}
}
gId('select-branch').onchange=e=>{
	browsingTree=browsingTree.map(v=>v.includes('?ref=')?`${v.split('?ref=',1)[0]}?ref=${e.target.value}`:v)
	window.location.href = `#${browsingTree.pop()}`
}
const copyCurrentUrl=async(f)=>{if(f){navigator.clipboard.writeText(`${String(window.location).split('#')[0]}#${gId('cud-inner').textContent}`);gId('cud-inner').innerHTML=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" height="1.5em"><path stroke="currentColor" stroke-linejoin="round" stroke-width="2" d="M9 8v3c0 .6-.4 1-1 1H5m11 4h2c.6 0 1-.4 1-1V5c0-.6-.4-1-1-1h-7a1 1 0 0 0-1 1v1m4 3v10c0 .6-.4 1-1 1H6a1 1 0 0 1-1-1v-7.1c0-.3 0-.5.2-.7l2.5-2.9c.2-.2.5-.3.8-.3H13c.6 0 1 .4 1 1Z"/></svg> copied to clipboard!`}else{gId('cud-inner').innerHTML=iconCopy+browsingTree.slice(-1)[0].slice(22)}}
const searchContents=()=>{gId('explore-content').childNodes.forEach(function(a){a.style.display=(a.getAttribute('data-search').toLowerCase().includes(gId('search-input').value.toLowerCase()))?'':'none'})}
const browseToggleView=async(manualSet=true)=>{
	if(manualSet)localStorage.setItem('browse-view-mode',(localStorage.getItem('browse-view-mode')=='list-group')?'grid':'list-group');
	gId('explore-content').setAttribute('class',localStorage.getItem('browse-view-mode'))
	gId('browse-view').innerHTML=(localStorage.getItem('browse-view-mode')=='list-group')?viewIcon:viewList;
}
const github_signin=()=>{localStorage.setItem('github_signin_last_page',window.location.href);window.location.href='https://github.com/login/oauth/authorize?client_id=Iv23liaWNIqsLBdsPiAY&redirect_uri=https://arialhamed.github.io/github/callback'}
const github_logout=()=>{localStorage.removeItem('github_token');window.location.reload()}

// GitHub display
gId('github-user-profile').insertAdjacentHTML('afterbegin', `<span style="max-width: 50%; text-align: left; float: left;">All done with <a href="https://api.github.com/" target="_blank">GitHub's API</a> (<a id="github-auth" onclick="${(github_token)?'github_logout()">log-out':'github_signin()">sign-in'}</a>).</span>`)

// Browsing controls
if(!localStorage.getItem('browse-view-mode'))localStorage.setItem('browse-view-mode','list-group');
browseToggleView(false)
// gId('search-input').value='';
gId('back-to-start').href=`#/users/${ghusr}/repos?per_page=100&sort=pushed`;

// Kick off when the page loads, or go straight to a stated url
// If there is a query named 'url', the page will go to that and extend the browsingTree. fun fact: this is why that's not called browsingHistory :3 that is user dependant now
const qUrl=window.location.hash.substring(1)
if(!qUrl){
	console.log('Resetting to all-repo view')
	window.location.href=`#/users/${ghusr}/repos?per_page=100&sort=pushed`
}else{
	let tempCurrentRepo = qUrl.slice(7).split('/').slice(0,2).join('/'); // copy of browsingCurrentRepo (not initialized yet)

	// If you landed in the contents of a repository
	if(qUrl.includes('?ref=')){
		// And if you landed beyond the root directory of the contents of the repository
		if(!qUrl.slice(7+tempCurrentRepo.length).startsWith('/contents?ref=')){
			browsingTree.push(`/repos/${tempCurrentRepo}/contents`)

			// Take the iterative value at after a number of chars as:
			// '/repos/' = 7 chars
			// '{user}/{repository}' = tempCurrentRepo.length
			// '/contents/' = 10 chars
			let [iterative, refId] = qUrl.slice(17+tempCurrentRepo.length).split('?ref=')

			// Takes the last item in browsingTree and add the value that is looping through the iterative
			// Don't include the last item as that will be added in when it loads
			iterative.split('/').slice(0,-1).forEach(s=>{
				browsingTree.push(`${browsingTree.at(-1)}/${s}`)
			})

			// Add branch ID to all the links
			browsingTree=browsingTree.map(s=>`${s}?ref=${refId}`)
		}

		// Add all-repo view URL to the start of browsingTree for all times you land in the contents of a repository
		browsingTree.unshift(`/users/${ghusr}/repos?per_page=100&sort=pushed`);
	}
	window.onhashchange()
}

</script>



{% include comments.html url=page.url %}