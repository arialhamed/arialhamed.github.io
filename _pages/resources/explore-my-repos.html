---
title: "Arial's repository explorer"
permalink: /resources/explore-my-repos/
redirect_from:
 - /resources/explore-my-repos
 - /resources/explore-repos
 - /resources/explore-repos/
 - /resources/explore-ari-repos
 - /resources/explore-ari-repos/
 - /resources/explore
 - /resources/explore/
 - /explore-my-repos
 - /explore-my-repos/
 - /explore-repos
 - /explore-repos/
 - /explore
 - /explore/
 - /explorer
 - /explorer/
layout: default
prism: true
music-metadata: true
pdf: true
---

<div id="github-user-profile">
	<select id="select-branch" title="Select a branch"></select>
	<div style="clear: both;"></div>
</div>

<!-- title -->
<a id="current-title"></a>

<!-- description -->
<div>
	<span id="current-description"></span>
	<svg id="edit-description" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" height="2em" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M11.32 6.176H5c-1.105 0-2 .949-2 2.118v10.588C3 20.052 3.895 21 5 21h11c1.105 0 2-.948 2-2.118v-7.75l-3.914 4.144A2.46 2.46 0 0 1 12.81 16l-2.681.568c-1.75.37-3.292-1.263-2.942-3.115l.536-2.839c.097-.512.335-.983.684-1.352l2.914-3.086Z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M19.846 4.318a2.148 2.148 0 0 0-.437-.692 2.014 2.014 0 0 0-.654-.463 1.92 1.92 0 0 0-1.544 0 2.014 2.014 0 0 0-.654.463l-.546.578 2.852 3.02.546-.579a2.14 2.14 0 0 0 .437-.692 2.244 2.244 0 0 0 0-1.635ZM17.45 8.721 14.597 5.7 9.82 10.76a.54.54 0 0 0-.137.27l-.536 2.84c-.07.37.239.696.588.622l2.682-.567a.492.492 0 0 0 .255-.145l4.778-5.06Z" clip-rule="evenodd"/></svg>
</div>

<!-- browsing controls -->
<!-- <svg height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M1 1H2V2H1M3 1H4V2H3M5 1H6V2H5M7 1H8V2H7M9 1h1V2H9M9 3h1V4H9M9 5h1V6H9M9 7h1V8H9M9 9h1v1H9M7 9H8v1H7M5 9H6v1H5M3 9H4v1H3M1 9H2v1H1M1 7H2V8H1M1 5H2V6H1M1 3H2V4H1M3 3H8V8H3M4 4H7V7H4"/></svg> -->
<div id="control-icons">
	<div>
		<svg title="Back" id="explore-back" class="float-left" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12l4-4m-4 4 4 4"/></svg>
		<svg title="Back to start" id="back-to-start" class="float-left" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 8 5 12 l4 4 M16 8 12 12 l4 4"/></svg>
		<svg title="Refresh" id="explore-refresh" class="float-left" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.7 7.7A7.1 7.1 0 0 0 5 10.8M18 4v4h-4m-7.7 8.3A7.1 7.1 0 0 0 19 13.2M6 20v-4h4"/></svg>
		<div id="search-field">
			<input type="search" onkeyup="searchContents()" onclick="searchContents()" id="search-input" placeholder="start typing here to search">
			<svg onclick="gId('search-input').value='';gId('search-input').focus();searchContents()" height="2em" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/></svg>
		</div>
	</div>
	<div>
		<svg title="New file" id="create-file" class="float-left" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-7Z" clip-rule="evenodd"/></svg>
		<svg title="New folder" id="create-folder" class="float-left" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 8H4m8 3.5v5M9.5 14h5M4 6v13a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1h-5.032a1 1 0 0 1-.768-.36l-1.9-2.28a1 1 0 0 0-.768-.36H5a1 1 0 0 0-1 1Z"/></svg>
		<svg title="Upload here" id="upload-file" class="float-left" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v9m-5 0H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-2M8 9l4-5 4 5m1 8h.01"/></svg>
		<input id="multi-select" type="checkbox" style="display:none"><label title="Start multiple selection" for="multi-select" class="float-left"><svg height="2.5em" style="color:inherit" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M6 1C11 1 11 1 11 6 11 11 11 11 6 11 1 11 1 11 1 6 1 1 1 1 6 1V3C9 3 9 3 9 6 9 9 9 9 6 9 3 9 3 9 3 6 3 3 3 3 6 3M6 13C11 13 11 13 11 18 11 23 11 23 6 23 1 23 1 23 1 18 1 13 1 13 6 13M8.895 14.347 10.461 16.121 4.982 21.547 1.591 18.678 2.817 17.034 4.696 18.939 8.895 14.347M13 6C13 5 13 5 15 5H21C23 5 23 5 23 6 23 7 23 7 21 7H15C13 7 13 7 13 6M13 12C13 11 13 11 15 11H21C23 11 23 11 23 12 23 13 23 13 21 13H15C13 13 13 13 13 12M13 18C13 17 13 17 15 17H21C23 17 23 17 23 18 23 19 23 19 21 19H15C13 19 13 19 13 18"/></svg></label>
		<svg title="Select all" id="select-all" class="float-left" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 11 11"><path fill-rule="evenodd" fill="currentColor" d="M1 1H2V2H1M3 1H4V2H3M5 1H6V2H5M7 1H8V2H7M9 1h1V2H9M9 3h1V4H9M9 5h1V6H9M9 7h1V8H9M9 9h1v1H9M7 9H8v1H7M5 9H6v1H5M3 9H4v1H3M1 9H2v1H1M1 7H2V8H1M1 5H2V6H1M1 3H2V4H1M3 3H8V8H3V3M4 4H7V7H4V4"/></svg>
		<svg title="Delete item" id="delete-item" class="float-left" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z"/></svg>

		<input id="toggle-view" type="checkbox" style="display:none"><label title="Toggle view" for="toggle-view" class="float-right">
			<svg id="list-view" style="color:inherit" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M9 8h10M9 12h10M9 16h10M4.99 8H5m-.02 4h.01m0 4H5"/></svg>
			<svg id="icon-view" style="color:inherit" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.143 4H4.857A.857.857 0 0 0 4 4.857v4.286c0 .473.384.857.857.857h4.286A.857.857 0 0 0 10 9.143V4.857A.857.857 0 0 0 9.143 4Zm10 0h-4.286a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286A.857.857 0 0 0 20 9.143V4.857A.857.857 0 0 0 19.143 4Zm-10 10H4.857a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286a.857.857 0 0 0 .857-.857v-4.286A.857.857 0 0 0 9.143 14Zm10 0h-4.286a.857.857 0 0 0-.857.857v4.286c0 .473.384.857.857.857h4.286a.857.857 0 0 0 .857-.857v-4.286a.857.857 0 0 0-.857-.857Z"/></svg>
		</label>
		<svg title="Download as repository as .zip" id="download-repo" class="float-right" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 13V4M7 14H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-2m-1-5-4 5-4-5m9 8h.01"/></svg>
		<label title="Pin this toolbar" for="pin-explorer-nav" class="float-right">
			<svg id="pin-explorer-nav-unpinned" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15a6 6 0 1 0 0-12 6 6 0 0 0 0 12Zm0 0v6M9.5 9A2.5 2.5 0 0 1 12 6.5"/></svg>
			<svg id="pin-explorer-nav-pinned" height="2.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M5 9a7 7 0 1 1 8 6.93V21a1 1 0 1 1-2 0v-5.07A7.001 7.001 0 0 1 5 9Zm5.94-1.06A1.5 1.5 0 0 1 12 7.5a1 1 0 1 0 0-2A3.5 3.5 0 0 0 8.5 9a1 1 0 0 0 2 0c0-.398.158-.78.44-1.06Z" clip-rule="evenodd"/></svg>
		</label><input id="pin-explorer-nav" type="checkbox" style="display:none">
		<div style="clear:both"></div>
	</div>
	<!-- <div style="clear: both"></div> -->
</div>

<!-- all cells -->
<div id="explore-content"></div> <!-- alternative: list-group -->
<br>

<!-- under the cells, displaying all except images already in cells -->
<div id="file-display">
</div>

<!-- <div id="commit-backdrop"></div> -->

<script type="text/javascript" src="https://arialhamed.github.io/static/js/prism.js" integrity="sha384-TkqOrDmcqktJ9KyGrO8dvy+cgNGxL8213a+Gjn9NWdSDFzuO0qXUfUjOQkv+OQHB" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://arialhamed.github.io/static/js/remarkable.min.js" integrity="sha384-+mAd+2zwsGbkQclpQUYAzd2sn40qJt1XvZ/y1tb2ff1EP6GEZ77FW1qwSt50qvrs" crossorigin="anonymous"></script>
<style>
/* GitHub credits & login, and branch toggle */
#github-user-profile{cursor:default;font-size:70%;opacity:.65}
#github-auth{cursor:pointer}
#github-auth:hover{color:white}
#select-branch{
	max-width: 50%;
	text-align: center;
	float: right;
	color: var(--font-color);
	background-color: var(--nav-overlay);
	border-radius: 1em;
}
#select-branch:empty{visibility:hidden}

/* Title & description */
#current-title{
	text-decoration:underline;
	text-align:center;
	font-size:200%;
	font-weight:500;
	margin:.1em 1.5em;
	color:var(--font-color);
	display:flex;
	flex-direction:column;
	line-height:1.8em;
	white-space:nowrap;
	text-overflow:ellipsis;
	overflow:hidden;
}
#current-title:hover{color:var(--anchor-color)}
#current-description{line-height:2em;/*Repository description*/}
#current-description svg{vertical-align:text-top;/*Private & fork icons*/}
#current-description + svg{float:right;/*Edit description icon*/}
#edit-description{cursor:pointer}

/* Explorer control icons & search */
#control-icons{position:static;top:0;padding:.5em 0}
#control-icons svg{color:var(--anchor-color);border-radius:.5em;cursor:pointer}
#control-icons svg:hover{transform:scale(1.3)}
#control-icons svg:active{background-color:var(--overlay-hover)}

/* Items within explore-content */
:has(>:nth-child(2))>.loader{display:none;/*Hide when there are at least 2 items in #explore-content or show-* (i.e. if .loader is not alone)*/}
#explore-content>.loader{margin:2em auto;grid-column:1 / 5;/*"rowspan" for grid display*/}
#explore-content img{/*Only explore-content image descendants*/max-width:100%;margin:auto}
#explore-content *{transition: none}/*Remove weird lag that can happen sometimes*/
.explore-cell:hover{background-color:var(--overlay-hover);color:var(--anchor-color)}
.explore-cell:hover .v-repo-details>svg{border:1px dashed #fff2}/*Highlight fork & private icons in hover*/
.explore-cell{
	background-color: var(--overlay);
	user-select: none;
	cursor: pointer;
	position: relative;
	margin: 2.5px;
	padding: .2rem .5rem;
	display: flex;
	flex-direction: row;
}
.explore-cell:has(img){padding:0}
.explore-cell:has(img) .v-name{padding:.2rem .5rem}
.v-name{width:100%;overflow-wrap:anywhere}
.v-repo-title{width:100%;overflow-wrap:anywhere;margin:auto}
.v-repo-details{display:flex;flex-direction:row;}
.v-repo-details>div{text-align:right;max-width:fit-content;display:flex;flex-direction:column}
.v-repo-details>div>span{font-size:50%;min-width:max-content}
.v-size{font-size:70%;max-width:fit-content;text-align:right;width:100%}

/*Toggle multi-select*/
#multi-select:checked + label{animation:hihi 1s linear 0s infinite normal}
@keyframes hihi{0%{rotate:0deg}10%{rotate:-10deg}20%{rotate:10deg}30%{rotate:-10deg}40%{rotate:10deg}50%{rotate:0deg}}
#control-icons:has(#multi-select:checked) + #explore-content {
	input[type="checkbox"]{display:block}
	label{display:block}
	.v-name{padding:0 1.2em}
}
#control-icons:has(#multi-select:checked) #delete-item{pointer-events:unset;color:var(--anchor-color)!important}
#control-icons:has(#multi-select:checked) #select-all{pointer-events:unset;color:var(--anchor-color)!important}
.explore-cell > input[type="checkbox"]{transform:scale(1.5)translate(.4em,.4em);display:none;margin:0;margin-right:.5em;position:absolute;top:0;left:0}
.explore-cell > label{position:absolute;width:100%;height:100%;display:none;margin-top:-.2rem;left:0}

/*Toggle pin*/
#control-icons:has(#pin-explorer-nav:checked){position:sticky;z-index:2;backdrop-filter:blur(5px);/*background:linear-gradient( rgb(0, 0, 0), rgba(0, 0, 0, 0) );*/}
#control-icons:has(#pin-explorer-nav:checked) #pin-explorer-nav-unpinned{display:none/*Hide unpinned icon when pinned*/}
#control-icons:has(#pin-explorer-nav:not(:checked)) #pin-explorer-nav-pinned{display:none/*Hide pinned icon when unpinned*/}

/*Grid view*/
#control-icons:has(#toggle-view:checked) #list-view{display:none}
#control-icons:has(#toggle-view:checked) + #explore-content{
	display:grid;
	grid-template-columns:repeat(4, 25%);
	.explore-cell{flex-direction:column;text-align:center}
	.explore-cell:has(img) .v-name{font-size:70%;}
	.v-size{margin:0 auto}
}
/*List view*/
#control-icons:has(#toggle-view:not(:checked)) #icon-view{display:none}
#control-icons:has(#toggle-view:not(:checked)) + #explore-content{
	display:flex;
	flex-direction:column;
	.explore-cell{text-align:left}
	.explore-cell:has(img){flex-direction:column;}
	.explore-cell:has(img) .v-name{text-align:center;}
}

.float-left{float:left}
.float-right{float:right}
#delete-item{color:var(--anchor-color-hover)!important;pointer-events:none}
#select-all{color:var(--anchor-color-hover)!important;pointer-events:none}


*[href='']{pointer-events:none;color:var(--anchor-color-hover);/*Disable if at all-repo view*/}
#explore-refresh:hover{animation-play-state:running}
#explore-refresh{animation:explore-refresh-rotate 1s linear 0s infinite;animation-play-state:paused}
@keyframes explore-refresh-rotate{from{rotate:0deg}to{rotate:360deg}}
#search-field{
	display: flex;
	height: 2.5em;
	/* margin-bottom: .5em; */
	background-color: rgba(0,0,0,0.2);
	border-radius: 8px;
}
#search-field svg{/*Cancel icon*/
	padding: .3em;
	cursor: pointer;
	height: inherit;
	color: var(--anchor-color)
}
#search-field svg:hover{color:var(--font-color)}
#search-input{
	width: 100%;
	height: inherit;
	background-color: transparent;
	color: var(--font-color);
	border-width: 0px;
	padding: .2em 0 .3em .5em;
}


/* Specific file styles when chosen to display */
#file-display{
	position:fixed;
	top:0;bottom:0;left:0;right:0;
	background-color:#0005;
	display:flex;
	flex-direction:column;
	z-index:7;
	overflow:scroll/*Enable scrolling for items in this div*/;
	padding-top:3em/*Space for title & close*/;
	align-items:center;
}
body:has(#fd-title,#commit-backdrop){overflow-y:hidden/*Disable the main scroll when file-display is shown*/}
#file-display:not(:has(*)){display:none/*If there are no items in this div, hide it*/;}
#fd-title{/*Title for file display*/
	display:flex;flex-direction:row;
	align-items:center;justify-content:center;
	position:fixed;
	top:0;
	background-color:var(--popup-background-color);
	width:100%;
	min-height:3em;
}
#fd-close{/*Close button for file display*/
	width:3em;height:3em;
	position:fixed;
	top:0;right:0;
	color:var(--nav-font-color);
	/* background-color:var(--popup-background-color); */
	padding:.25em;
}
#fd-close:hover{border:1px dashed var(--nav-font-color-hover)}
#fd-image-pagefit-container{/*Checkbox for images in file display*/
	display:flex;flex-direction:row;
	position:fixed;
	top:3em;right:0;
	height:3em;
	background-color:var(--popup-background-color);
	padding:0 1em;
}
#file-display:has(#fd-image-pagefit:checked) > #fd-image{overflow:auto;max-width:100%;/*Toggle Page Width of an image in file display*/}
#fd-nav{z-index:1;}
#fd-nav > svg{
	position:fixed;
	width:5rem;
	height:5rem;
	bottom:0;
	background-color:#0005;
	color:white;
}
#fd-nav > svg:hover{background-color:#000a;}
#fd-nav > svg:nth-child(1){left:0;}
#fd-nav > svg:nth-child(2){right:0;}
#fd-nav > svg:nth-child(3){right:5em;}
#fd-audio-1{flex:1;display:flex;overflow:auto;justify-content:center;width:100%;}
#fd-audio-thumbnail{max-width:100%;object-fit:contain;}
#fd-audio-lyrics{
	/* position:absolute; */
	/* background-color:var(--popup-background-color); */
	font-size:150%;
	padding:0 1em;
	/* align-self:end; */
	text-align:center;
	flex:1;
	background:url('https://raw.githubusercontent.com/arialhamed/static/main/images/spinner.gif');
	background-size:auto 100%;
	background-repeat:no-repeat;
	background-position:center center;
	text-shadow:-.5px -.5px 0 black, .5px -.5px 0 black, -.5px .5px 0 black, .5px .5px 0 black;
	display:flex;
	flex-direction:column;
}
#fd-audio-lyrics > span{display:none;}
#fd-audio-lyrics.show-lyrics > span{display:block;}
#fd-audio-lyrics-toggle{width:5em;cursor:pointer}
#fd-audio-lyrics-toggle:hover{scale:1.1}
#fd-audio-volume{
	width:5em;
	accent-color:var(--anchor-color);
	writing-mode:vertical-lr;
	direction:rtl;
}
#fd-audio-2{
	width:100%;
	display:flex;
	flex-direction:row;
	justify-content:space-around;
}
#fd-audio-2 > div{
	display:flex;
	flex-direction:column;
	justify-content:space-around;
}
#fd-audio-2 > div > span{font-size:200%;}
#fd-audio-toggle{width:10em;}
#fd-audio-toggle:hover,#fd-audio-shuffle:hover,#fd-audio-loop:hover{scale:1.1;cursor:pointer;}
#fd-audio-slider{
	accent-color:var(--anchor-color);
	width:calc(100% - 10rem);
	height:5rem;
}

#show-audio{
	width: 90%;
	accent-color: var(--anchor-color);
}
.explore-display-audio{
	display: block;
	text-align: center;
	position: sticky;
	position: -webkit-sticky;
	padding: 1em;
	bottom: 1em;
	background-color: #0007;
	background-image: url("");
	background-size: auto 100%;
	background-repeat: no-repeat;
	background-blend-mode: overlay;
	width: calc(100% - 2em);
	z-index: 4;
	border-radius: 2em;
	margin: auto;
}
#explore-display-close:hover{transform: rotate(180deg) scale(1.5)}
#explore-display-close{
	float: right;
	cursor: pointer;
	width: 3em;
	position: fixed;
	right: 1em;
	bottom: 1em;
}
.explore-display-image #explore-display-close{
	top: unset;
	left: 1.5em;
	/* bottom: -1.5em; */
}
.explore-display-audio #explore-display-close{
	top: -.2em;
	right: -.5em;
}
#explore-display-close + a{
	font-size: 175%;
	position: relative;
	word-wrap: anywhere;
}
/* .explore-display-image #explore-display-close + a{width:calc(100% - 3em);display:block} */
.explore-display-audio #explore-display-close + a{left:0;padding:.4em;border-radius:.75em;-webkit-box-decoration-break:clone;-o-box-decoration-break:clone;box-decoration-break:clone}
#commit-backdrop{
	position:fixed;
	top:0;left:0;bottom:0;right:0;
	background-color:#0005;
	backdrop-filter:blur(5px);
	text-align:center;
	line-height:100vh;
	z-index:8;
	font-size:300%;
}

/* Audio-specific controls */
#audio-controls{display:flex;height:6em}
#audio-controls svg{cursor:pointer}
#audio-controls span{font-family:var(--bs-font-monospace);font-size:1.2em;line-height:1em;margin-top:1em}
#audio-controls *:first-child{margin:auto;margin-right:0}
#audio-controls *:last-child{margin:auto;margin-left:0}
#audio-controls svg{transition:all .1s}
#audio-controls svg:hover{transform:scale(1.1)}
#audio-controls svg:active{transform:scale(.9)}
#audio-decrease, #audio-increase{height:60%}
#audio-increase{margin-left:.25em}
#audio-volume{display:inline}
#audio-volume div{display:flex;flex-direction:row}
#audio-volume div *{margin:auto;width:2em}
#audio-music{width:3em}

/* Markdown-specific controls */
#md-parsed{
	text-align:initial;
	padding:1rem;
	background-image:url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' stroke='grey' stroke-width='2' stroke-dasharray='40%2c 10' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
	width:100%;
	flex:1;
}
#non-md{flex:1;width:100%;display:flex;flex-direction:column}
#file-display:has(#md-parse-toggle:checked){
	#md-parsed{display:flex}
	#non-md{display:none}
}
#file-display:not(:has(#md-parse-toggle:checked)){
	#md-parsed{display:none}
	#non-md{display:flex}
}

</style>
<script>

// Third-party library objects
const mdConverter=new remarkable.Remarkable({html: true}); // Parse markdown text
const modules = {}

// Constants
const extV=['.webm','.mp4','.mov','.wmv','.avi','.flv','.swf','.mkv','.webm'];
const extS=['.3gp','.aa','.aac','.aax','.act','.aiff','.alac','.m4a','.amr','.ape','.au','.awb','.dss','.dvf','.flac','.gsm','.iklax','.ivs','.m4b','.m4p','.mmf','.movpkg','.mp3','.mpc','.msv','.nmf','.ogg','.opus','.ra','.raw','.rf64','.tta','.voc','.vox','.wav','.wma','.wv','.8svx','.cda','.oga','.mogg','.rm'];
const extA=['.7z','.zip','.apk','.apks','.xapk','.arc','.ark','.jar','.zpaq','.zip','.tar.gz','.tar.bz2','.tgz','.rar','.wad','.pk3','.exe'];
const ext3=['.3mf','.stl','.glb','.gltf','.obj','.amf'];
const extI=['.avif','.gif','.jpg','.jpeg','.jfif','.pjpeg','.pjp','.png','.svg','.webp','.bmp','.ico','.cur','.tif','.tiff','.kra','.jpg_large'];
const extR=['.csv','.tsv','.xlsx'];
const audioPlayer=new Audio();
audioPlayer.shuffle=false;
audioPlayer.loop=true;
audioPlayer.togglePlay=function(){this.paused?this.play():this.pause()}
audioPlayer.volumeAdd=function(f=0){this.volume=clamp(0,this.volume+f,1)}
const pathPaused=`<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 18V6l8 6-8 6Z"/>`
const pathPlaying=`<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 6H8a1 1 0 0 0-1 1v10c0 .6.4 1 1 1h1c.6 0 1-.4 1-1V7c0-.6-.4-1-1-1Zm7 0h-1a1 1 0 0 0-1 1v10c0 .6.4 1 1 1h1c.6 0 1-.4 1-1V7c0-.6-.4-1-1-1Z"/>`
const privateIcon=`<svg title="This repository is private" class="icon-private" height="1.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M8 10V7a4 4 0 1 1 8 0v3h1a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h1Zm2-3a2 2 0 1 1 4 0v3h-4V7Zm2 6a1 1 0 0 1 1 1v3a1 1 0 1 1-2 0v-3a1 1 0 0 1 1-1Z" clip-rule="evenodd"/></svg>`
const forkIcon=`<svg title="This repository is a fork" class="icon-fork" height="1.5em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M5 6a3 3 0 1 1 4 2.83V10a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V8.83a3.001 3.001 0 1 1 2 0V10a3 3 0 0 1-3 3h-1v2.17a3.001 3.001 0 1 1-2 0V13h-1a3 3 0 0 1-3-3V8.83A3.001 3.001 0 0 1 5 6Z" clip-rule="evenodd"/></svg>`
const uploadFileInput=Object.assign(document.createElement('input'),{type:'file',multiple:true});

// Browsing control variables
let debog;
let browsingTree=[];
let mediaArray=[];
let mediaArrayRandom=[];
let mediaArrayLocation='';
let busRoute=[];
let browsingCurrentRepo='';
let ghusr='arialhamed';
let intervalsDict={};

// The following will read each file or content (or repos) and display into the explore-content element
const addObjectToView=async(e)=>{
	if(e.name=='.gitkeep'&&e.size==0)return;
	let contentString=`<a class="explore-cell" data-path="${e.name}"`;
	let selectInput=`<label for="${e.sha}"></label><input class="explore-cell-select" type="checkbox" id="${e.sha}" />`;
	if (e.git_url.startsWith('git://')){ // Is the record from the start?
		// Adds the repository names and the prospective API URLs as cells
		contentString+=` href="#${e.url.slice(22)}/contents?ref=${e.default_branch}">
			<span class="v-repo-title">${e.name}</span>
			<div class="v-repo-details">
				${e.private?privateIcon:''}${e.fork?forkIcon:''}
				<div>
					<span>${new Date(e.pushed_at).toLocaleDateString(navigator.languages[0],{year:'numeric',month:'short',day:'numeric',hour:'numeric',minute:'numeric',second:'numeric'})}</span>
					<span>${formatBytes(e.size)}</span>
				</div>
			</div>
		</a>`;
	}else{
		// Is the record a directory?
		if (e.type == 'dir'){
			contentString+=` data-type="tree" href="#${e.url.slice(22)}">
				${selectInput}
				<span class="v-name">${e.name}</span>
				<svg class="v-folder-icon" height="1.2em" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M3 6c0-1.1.9-2 2-2h5.5a2 2 0 0 1 1.6.7L14 7H3V6Zm0 3v10c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V9H3Z" clip-rule="evenodd"/></svg>
			</a>`;
		}else{
			// This record is a file in these brackets
			contentString+=` data-type="blob" >${selectInput}`;
			// Is the record an image?
			if (extI.some(v => e.download_url.split('?',1)[0].toLowerCase().endsWith(v))){
				contentString+=`<img loading="lazy" src="${e.download_url}" alt="Unable to display image" /><span class="v-name">${e.name}</span></a>`;
			}else{
				contentString+=`<span class="v-name">${e.name}</span><span class="v-size">${formatBytes(e.size)}</span></a></span>`;
			}
			mediaArray.push([e.download_url, e.git_url]);
			mediaArrayRandom.splice((mediaArrayRandom.length+1)*Math.random()|0,0,[e.download_url, e.git_url])
		}
	}
	const template=document.createElement('template');//Purpose of template element
	template.innerHTML=contentString.trim();//Remove text nodes and add to template
	const exploreCell=template.content.firstChild;//Get the first child of template
	if(e.download_url){//If download_url exists, set showFile as onclick, except if it is select checkbox & it's label
		exploreCell.onclick=()=>showFile(e.url);
		exploreCell.querySelector('input[type="checkbox"]').onclick=e=>e.stopPropagation();
		exploreCell.querySelector('label').onclick=e=>e.stopPropagation();
		busRoute.push(e.url);
	}
	gId('explore-content').appendChild(exploreCell);//Add to DOM
}
window.onhashchange=async()=>{
	const inUrl = window.location.hash.slice(1);
	const isReload = inUrl==browsingTree.at(-1); // Only encountered when just running window.onhashchange() alone without changing browsingTree 
	busRoute=[]; // Clear bus route
	gId('file-display').innerHTML='';

	if(isReload){browsingTree.pop();console.log('refreshing')};
	browsingTree.at(-2)==inUrl?browsingTree.pop():browsingTree.push(inUrl);

	gId('explore-content').innerHTML='<span class="loader" data-path=""></span>';

	try{
		// Get repository contents or list repositories of a user
		browseJson=await fetch(`https://api.github.com${inUrl}`, github_api_headers({refresh: isReload})).then(r=>r.json());
		if(browseJson.status=='403')throw browseJson;
		['explore-back','back-to-start','create-file','create-folder','upload-file','download-repo'].forEach(i=>gId(i).style.cssText='pointer-events:none;color:var(--anchor-color-hover)');
		['multi-select','toggle-view'].forEach(e=>document.querySelector(`#${e} + label`).style.cssText='pointer-events:none;color:var(--anchor-color-hover)');
		if (inUrl.startsWith(`/users/${ghusr}/repos`)){ // If current link is the start
			browsingTree=[inUrl];
			gId('current-title').textContent='My GitHub repositories';
			gId('current-title').removeAttribute('href');
			gId('current-description').innerHTML=`<i>&lt;description will be shown here when you select a repository below&gt;</i>`;
			browsingCurrentRepo = '' // Reset value as we are not in a repo here
			gId('select-branch').innerHTML=''; // Clear branches dropdown
			['multi-select','toggle-view'].forEach(e=>{if(gId(e).checked)gId(e).click()}); // Uncheck multi-select

			if(github_token){
				const privateRepos=await fetch('https://api.github.com/user/repos?per_page=100&visibility=private',github_api_headers({refresh: isReload})).then(r=>r.json()).then(j=>j.filter(v=>v.owner.login==ghusr))
				browseJson.push(...privateRepos)
			}
			browseJson.sort((a,b)=>b['pushed_at'].localeCompare(a['pushed_at']))
		}else{ // If repository selected or in contents of repository (not at the start of the page)
			gId('explore-back').onclick=()=>window.location.href=`#${browsingTree.at(-2)}`;
			['explore-back','back-to-start','download-repo'].forEach(i=>gId(i).style.cssText='color:var(--anchor-color)');
			['toggle-view'].forEach(e=>document.querySelector(`#${e} + label`).style.cssText='pointer-events:auto;color:var(--anchor-color)');
			if(github_token){// Show write functions to authenticated user
				['create-file','create-folder','upload-file'].forEach(i=>gId(i).style.cssText='color:var(--anchor-color)');
				['multi-select'].forEach(e=>document.querySelector(`#${e} + label`).style.cssText='pointer-events:auto;color:var(--anchor-color)');
			}

			// Get repository of current URL, regardless where you are (format is `{user}/{repository}`)
			const rrCurrent = inUrl.split('/').slice(2,4).join('/');

			// If we are changing from all-repo view to a repo, run this once.
			if (browsingCurrentRepo!=rrCurrent){ // If the browsing repo does not match the current repo
				browsingCurrentRepo=rrCurrent

				// Set title & description of current repo
				const rrDeets = await fetch(`https://api.github.com/repos/${browsingCurrentRepo}`, github_api_headers({refresh: isReload})).then(r=>{if(!r.ok){throw r}return r.json()})
				gId('current-description').innerHTML=`${rrDeets.private?privateIcon:''}${rrDeets.fork?`<a href="${rrDeets.parent.html_url}">${forkIcon}</a>`:''}${rrDeets.description===null?'<i>No description</i>':rrDeets.description}`;
				gId('current-title').textContent=rrDeets.name;
				gId('current-title').href=rrDeets.html_url

				// Set branch choices
				const branches = await fetch(`https://api.github.com/repos/${browsingCurrentRepo}/branches`, github_api_headers({refresh: isReload})).then(r=>r.json())
				gId('select-branch').innerHTML=branches.map(v=>`<option value=\"${v.name}\"${inUrl.endsWith(v.name)?'selected':''}>${v.name}</option>`).join('')
			}

			// Sometimes, a repository will just be empty (no commits) so there are no files to sort and build the view
			if(browseJson.status=='404'){
				gId('explore-content').insertAdjacentHTML('beforeend', `<span id="repo-is-empty" style="text-align:center;font-size:200%;padding:2em;font-style:italic;">${browseJson.message}</span>`);return
			}else{ // At this point, we are inside a repository with commits, so let's put the folders first
				browseJson.sort((a, b) => a.type.localeCompare(b.type))
			}
		}
		console.log(browsingTree);

		// Loops through each... whatever thing. He needs some milk
		browseJson.forEach(addObjectToView)
		if(gId('explore-content').children.length==1)gId('explore-content').insertAdjacentHTML('beforeend','<h2 title="Only has a .gitkeep file that is 0 bytes">This folder is empty</h2>');
	}catch(err){
		console.log(err)
		gId('explore-back').href='';
		gId('current-description').innerHTML='';
		if(err.message==null){
			gId('current-title').textContent='Uh oh, that URL is invalid'
			gId('explore-content').innerHTML=`<a style="text-align:center;font-size:200%;margin:2em;" href="#/users/${ghusr}/repos?per_page=100&sort=pushed">Return to repositories view?</a>`;
		}else{
			gId('current-title').textContent='GitHub API'
			gId('explore-content').innerHTML=`<span style="text-align:center;font-size:150%;margin:2em;">${err.message}<br><br><a href="${err.documentation_url}">GitHub API Docs</a></span>`;
		}
		return
	}
}
const downloadFile=async(inUrl)=>{
	const fileDetails = await fetch(`https://api.github.com${inUrl}`, github_api_headers()).then(r=>r.json())
	fetch(fileDetails.git_url, github_api_headers({raw: true}))
	.then(r=>r.blob())
	.then(b=>Object.assign(document.createElement('a'),{href:window.URL.createObjectURL(b),download:fileDetails.name}).click())
	.then(f=>console.log(`"${fileDetails.name}" has been downloaded`))
	// const xhr = new XMLHttpRequest();
	// xhr.progress=e=>console.log(e.loaded/fileDetails.size);
	// xhr.open('GET', fileDetails.git_url)
	// xhr.setRequestHeader('Accept', `application/vnd.github.v3+json`)
	// xhr.setRequestHeader('Authorization', (github_token)?`token ${github_token}`:``)
	// xhr.send()
	// console.log("what")
}
const showFile=async(inUrl)=>{
	console.log(`showFile(${inUrl})`);

	// Get the queen of divs
	const fileDisplay=gId('file-display');

	// Set navigation functions
	const prevFile=()=>showFile(busRoute.at(busRoute.indexOf(inUrl)==0?busRoute.length-1:busRoute.indexOf(inUrl)-1));
	const nextFile=()=>showFile(busRoute.at(busRoute.indexOf(inUrl)==busRoute.length-1?0:busRoute.indexOf(inUrl)+1));

	// Show loader spinner while loading file details
	fileDisplay.innerHTML='<span class="loader"></span>';

	// Get file details
	const thisFile=await fetch(inUrl, github_api_headers({refresh: true})).then(r=>r.json());

	// Builds 2 elements, the first one is the close button, X, and the second one is the name of the file, and also
	fileDisplay.insertAdjacentHTML('beforeend',`
		<a id="fd-title" href="${thisFile.download_url}">${thisFile.name}</a>
		<svg id="fd-close" aria-hidden="true" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linejoin="round" stroke-width="2" d="M4 20 20 4m0 16L4 4"/></svg>
		<div id="fd-nav">
			<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M7 6a1 1 0 0 1 2 0v4l6.4-4.8A1 1 0 0 1 17 6v12a1 1 0 0 1-1.6.8L9 14v4a1 1 0 1 1-2 0V6Z"></svg>
			<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M17 6a1 1 0 1 0-2 0v4L8.6 5.2A1 1 0 0 0 7 6v12a1 1 0 0 0 1.6.8L15 14v4a1 1 0 1 0 2 0V6Z"/></svg>
		</div>
	`.trim());
	gId('fd-close').onclick=()=>fileDisplay.innerHTML='';
	fileDisplay.querySelector('#fd-nav > svg:nth-child(1)').onclick=()=>prevFile();
	fileDisplay.querySelector('#fd-nav > svg:nth-child(2)').onclick=()=>nextFile();

	if(extI.some(v=>thisFile.name.toLowerCase().endsWith(v))){// Images
		// if(gId('explore-content').classList[0]=='list-group'){return} // Images are already quite maximized when explore-content is in list-group mode, so not required here
		fileDisplay.insertAdjacentHTML('beforeend',`
			<div id="fd-image-pagefit-container">
				<input id="fd-image-pagefit" type="checkbox" checked>
				<label for="fd-image-pagefit" style="line-height:3em;">Page Fit</label>
			</div>
			<img id="fd-image" style="margin:auto;" src="${thisFile.download_url}">
		`.trim());
	}else if(extV.some(v=>thisFile.name.toLowerCase().endsWith(v))){// Video
		fileDisplay.insertAdjacentHTML('beforeend',`<video id="fd-video" style="width:100%;margin:auto;overflow:auto;" controls autoplay loop><source src="${thisFile.download_url}" type="video/webm"></video>`);
	}else if(extS.some(v=>thisFile.name.toLowerCase().endsWith(v))){// Audio
		fileDisplay.insertAdjacentHTML('beforeend',`
		<div id="fd-audio-1">
			<!-- img id="fd-audio-thumbnail" src="https://raw.githubusercontent.com/arialhamed/static/main/images/spinner.gif" -->
			<div id="fd-audio-lyrics"></div>
		</div>
		<div id="fd-audio-2">
			<div>
				<span id="fd-audio-duration-current">--:--</span>
				<svg id="fd-audio-shuffle" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.5 9.2 15 7h5m0 0-3-3m3 3-3 3M4 17h4l1.6-2.3M4 7h4l7 10h5m0 0-3 3m3-3-3-3"/></svg>
			</div>
			<svg id="fd-audio-lyrics-toggle" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28"><path fill-rule="evenodd" d="M7 2Q2 2 2 7V21q0 5 5 5h3q1 0 1-1t-1-1H7q-3 0-3-3V7Q4 4 7 4H21q3 0 3 3v4q0 1 1 1t1-1V7q0-5-5-5H7M7 6Q6 6 6 7T7 8H21q1 0 1-1T21 6H6m1 4q-1 0-1 1t1 1H21q1 0 1-1t-1-1H7m0 4q-1 0-1 1t1 1q0 0 0 0h5q1 0 1-1t-1-1H7m0 4q-1 0-1 1t1 1h5q1 0 1-1t-1-1H7m18-4-9 1q-1 .12-1 1v6q-2 0-2 2t2 2 2-2V17l7-1v5q-2 0-2 2t2 2 2-2V15q0-1.12-1-1"/></svg>
			<svg id="fd-audio-toggle" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">${pathPaused}</svg>
			<!-- fd-audio-volume -->
			<div>
				<span id="fd-audio-duration-max">--:--</span>
				<svg id="fd-audio-loop" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m16 4 3 3H5v3m3 10-3-3h14v-3m-9-2.5 2-1.5v4"/></svg>
			</div>
		</div>
		<input id="fd-audio-slider" value="0" type="range">
		`);

		const audioVolume=Object.assign(document.createElement('input'),{id:'fd-audio-volume',type:'range',value:audioPlayer.volume*100,max:100});
		gId('fd-audio-toggle').insertAdjacentElement('afterend',audioVolume);
		const audioSlider=gId('fd-audio-slider');
		const audioDurationCurrent=gId('fd-audio-duration-current');
		const audioDurationMax=gId('fd-audio-duration-max');
		const audioToggle=gId('fd-audio-toggle');
		const audioLyrics=gId('fd-audio-lyrics');
		const audioLyricsToggle=gId('fd-audio-lyrics-toggle');
		audioLyricsToggle.value=false;

		var audioMainLoop=setInterval(()=>{
			if(audioSlider==null){
				audioPlayer.pause();
				clearInterval(audioMainLoop);
			}else{
				audioSlider.value=audioPlayer.currentTime*8;
				audioDurationCurrent.innerHTML=new Date(audioPlayer.currentTime*1000).toISOString().slice(14, 19)
				audioDurationMax.innerHTML=new Date((isNaN(audioPlayer.duration)?0:audioPlayer.duration)*1000).toISOString().slice(14, 19);
				// gId('audio-volume-num').innerHTML=parseInt(audioPlayer.volume*100)
				audioVolume.value=audioPlayer.volume*100;
				// if(audioPlayer.meta&&audioPlayer.meta.common.lyrics){
				// 	const possibleLines=audioPlayer.meta.common.lyrics.at(0).syncText.filter(v=>v.timestamp<audioPlayer.currentTime*1000);
				// 	if(possibleLines.length>=1){
				// 		audioLyrics.innerHTML=possibleLines.at(-1).text
				// 	}else{
				// 		audioLyrics.innerHTML='♪'
				// 	}
				// }
			}
		}, 125)

		gId('fd-close').addEventListener('click',()=>{
			window.onkeydown=()=>{};
			audioPlayer.pause()
			audioMainLoop?clearInterval(audioMainLoop):'';
		})

		URL.revokeObjectURL(audioPlayer.src);
		audioPlayer.src = '';
		fetch(thisFile.git_url, github_api_headers({raw: true}))
		.then(r=>r.blob())
		.then(b=>{
			audioPlayer.src = URL.createObjectURL(b);
			return modules.parseBlob(b);
		})
		.then(m=>{
			audioPlayer.meta=m;
			// gId('fd-audio-thumbnail').src=(audioPlayer.meta.common.picture==null)?'':embeddedImgToURI(audioPlayer.meta.common.picture[0]);
			gId('fd-audio-lyrics').style.backgroundImage=`url('${(audioPlayer.meta.common.picture==null)?'':embeddedImgToURI(audioPlayer.meta.common.picture[0])}'`;
			if(m&&m.common.lyrics){
				audioLyrics.innerHTML='';
				m.common.lyrics.at(0).syncText.forEach(e=>{
					audioLyrics.insertAdjacentHTML('beforeend',`<span id="${e.timestamp}">${e.text}</span>`);
					gId(`${e.timestamp}`).onclick=()=>{audioPlayer.currentTime=e.timestamp/1000};
				})
			}
		})


		// debugger;
		// const mediaSource = new MediaSource();
		// audioPlayer.src = URL.createObjectURL(mediaSource);
		// mediaSource.addEventListener('sourceopen', async ()=>{
		// 	const response = await fetch(gitUrl, github_api_headers({raw: true}))
		// 	console.log(`response: ${response}`)
		// 	const reader = response.body.getReader();
		// 	console.log(`reader: ${reader}`)
		// 	const mimeType = 'audio/flac' //response.headers.get('Content-Type');
		// 	console.log(`mimeType: ${mimeType}`)
		// 	const sourceBuffer = mediaSource.addSourceBuffer(mimeType);
		// 	console.log(`sourceBuffer: ${sourceBuffer}`)
		// 	let isFirstChunk = true;
		// 	while (true) {
		// 		const { done, value } = await reader.read()
		// 		if (done) {
		// 			sourceBuffer.endOfStream();
		// 			break;
		// 		};
		// 		sourceBuffer.appendBuffer(value);
		// 		if (isFirstChunk) {
		// 			audioPlayer.play().catch(error=>console.error("Error playing audio:", error));
		// 			isFirstChunk = false;
		// 		}
		// 	}
		// 	response.blob()
		// 	.then(b=>modules.parseBlob(b))
		// 	.then(m=>{
		// 		debog=m;
		// 		ogilvie.src=(m.common.picture==null)?'':embeddedImgToURI(m.common.picture[0])
		// 	})
		// })

		audioPlayer.onloadedmetadata=function(){
			this.play();
			audioSlider.max=this.duration*8;
		}
		audioPlayer.onended=function(){!audioPlayer.loop?nextFile():''}

		audioSlider.oninput=function(){audioPlayer.currentTime=this.value/8} // Slider change current time
		audioToggle.onclick=()=>{audioPlayer.togglePlay()} // Play/Paused toggle
		audioPlayer.onplay=()=>{audioToggle.innerHTML=pathPlaying}; // Display toggle icon for played
		audioPlayer.onpause=()=>{audioToggle.innerHTML=pathPaused}; // Display toggle icon for paused
		audioVolume.oninput=function(){audioPlayer.volume=this.value/100} // Slider change volume
		audioLyricsToggle.onclick=()=>{
			audioLyricsToggle.value=!audioLyricsToggle.value;
			audioLyrics.classList.toggle('show-lyrics');
			if(audioLyricsToggle.value){
				audioLyricsToggle.style.fill='var(--anchor-color)';
			}else{
				audioLyricsToggle.style.fill=''
			}
		}
		// [['in',.01],['de',-.01]].forEach(e=>{gId('audio-'+e[0]+'crease').onclick=()=>{audioPlayer.volumeAdd(e[1])}})

		// window.onkeydown=function(){
		// 	// catches anything that does not require text input
		// 	if(!(('color|date|datetime-local|email|month|number|password|search|tel|text|time|url|week'.includes(document.activeElement.type)&&document.activeElement.tagName==='INPUT')||document.activeElement.tagName==='TEXTAREA')){
		// 		keyCodeUnassigned=true;
		// 		switch(this.keyCode){
		// 			case 74: case 37: audioPlayer.currentTime -= 3; break;
		// 			case 75: case 32: audioPlayer.togglePlay(); break;
		// 			case 76: case 39: audioPlayer.currentTime+=3; break;
		// 			case 38: audioPlayer.volumeAdd(.01); break;
		// 			case 40: audioPlayer.volumeAdd(-.01); break;
		// 			default: keyCodeUnassigned=false
		// 		}
		// 		if(keyCodeUnassigned)this.preventDefault();
		// 	}
		// }
		// gId('audio-volume').onwheel=e=>{e.preventDefault();audioPlayer.volumeAdd(Math.max(e.deltaX,-e.deltaY)>0?-.01:.01)}
		audioSlider.onwheel=e=>{e.preventDefault();audioPlayer.currentTime=clamp(0,audioPlayer.currentTime+(Math.max(e.deltaX,-e.deltaY)>0?-1:1),audioPlayer.duration)}
		gId('fd-audio-shuffle').style.color=audioPlayer.shuffle?'var(--anchor-color)':'var(--font-color)';
		gId('fd-audio-shuffle').onclick=function(){audioPlayer.shuffle=!audioPlayer.shuffle;this.style.color=audioPlayer.shuffle?'var(--anchor-color)':'var(--font-color)'}
		gId('fd-audio-loop').style.color=audioPlayer.loop?'var(--anchor-color)':'var(--font-color)';
		gId('fd-audio-loop').onclick=function(){audioPlayer.loop=!audioPlayer.loop;this.style.color=audioPlayer.loop?'var(--anchor-color)':'var(--font-color)'};

	}else if(ext3.some(v=>thisFile.name.toLowerCase().endsWith(v))){// 3D models
		fileDisplay.insertAdjacentHTML('beforeend',`<model-viewer alt="${decodeURIComponent(thisFile.name)}" src="${thisFile.download_url}" shadow-intensity="1" camera-controls touch-action="pan-y"></model-viewer>`);
	}else if(extA.some(v=>thisFile.name.toLowerCase().endsWith(v))){// Archive files
		fileDisplay.insertAdjacentHTML('beforeend',"<p>Contents of this file can not be parsed here.</p>");
	}else if(thisFile.name.toLowerCase().endsWith(".pdf")){// PDFs
		gId('fd-nav').insertAdjacentHTML('beforeend','<svg id="pdf-viewer-save" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M11 16h2m6.707-9.293-2.414-2.414A1 1 0 0 0 16.586 4H5a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V7.414a1 1 0 0 0-.293-.707ZM16 20v-6a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v6h8ZM9 4h6v3a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1V4Z"/></svg>');
		fileDisplay.insertAdjacentHTML('beforeend',`<iframe id="pdf-viewer" style="flex:1;width:100%;" src="/static/pdfjs-5.3.31-dist/web/viewer.html?file=${thisFile.download_url}"></iframe>`);
		gId('pdf-viewer-save').onclick=()=>{
			// const apiUrl = `https://api.github.com/repos/${browsingCurrentRepo}/git`;
			const reader = new FileReader();
			let [refinedUrl, refId] = thisFile.url.split('?ref=');
			reader.onload=async()=>{
				const updateRefResponse=await githubCommit([{content:reader.result,path:thisFile.path}],browsingCurrentRepo,refId)
				if(updateRefResponse.ok){
					showFile(inUrl);
					raiseToast('PDF edits has been saved')
				}else{
					raiseToast('Error encountered while saving, check console logs')
				}
			};
			gId('pdf-viewer').contentWindow.PDFViewerApplication.pdfDocument.saveDocument()
			.then(blob=>reader.readAsDataURL(new Blob([blob], {type: 'application/pdf'})))
		}
	}else{
		fileDisplay.insertAdjacentHTML('beforeend',`<div id="non-md"><pre style="background-color:#333a;height:calc(100% - 1em);" data-src="${thisFile.download_url}" data-download-link><code id="fd-text" class="line-numbers language-${thisFile.name.split('.').pop()}">${atob(thisFile.content).replace(/\</g, '&lt;')}</code></pre></div>`);
		Prism.highlightElement(gId('fd-text'));
		
		if(thisFile.name.toLowerCase().endsWith('.md')){
			// The code `thisFile.content.replace(/\</g, "&lt;")` replaces all `<` symbols with the escaped version, due to a HTML issue with the pre element
			fileDisplay.insertAdjacentHTML('beforeend',`<span id="md-parsed">${mdConverter.render(atob(thisFile.content).substring(1).split('---').pop())}</span>`)
			gId('fd-nav').insertAdjacentHTML('beforeend','<input id="md-parse-toggle" type="checkbox" style="display:none;"><svg id="md-parse-toggle-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><rect fill="#fff" height="512" rx="15%" width="512"/><path d="m410 366h-308c-14 0-26-12-26-26v-170c0-14 12-26 26-26h307c14 0 26 12 26 26v170c0 14-11 26-25 26zm-308-204c-4 0-9 4-9 9v170c0 5 4 9 9 9h307c5 0 9-4 9-9v-171c0-5-4-9-9-9h-307zm26 153v-119h34l34 43 34-43h35v118h-34v-68l-34 43-34-43v68zm216 0-52-57h34v-61h34v60h34z"/></svg>');
			gId('md-parse-toggle-icon').onclick=()=>gId('md-parse-toggle').click();
		}
	}
}
const githubCommit=async(listOfFiles,repo,refId)=>{
	let veilStopwatch=0;
	const updateProgress=()=>gId('commit-backdrop').textContent=Number(++veilStopwatch/(listOfFiles.length+4)).toLocaleString(undefined,{style:'percent',minimumFractionDigits:2});
	gId('file-display').insertAdjacentHTML('afterend','<div id="commit-backdrop"></div>');
	const apiUrl=`https://api.github.com/repos/${repo}/git`;
	const latestCommitSha=await fetch(`${apiUrl}/refs/heads/${refId}`,{cache:'no-store',headers:{Authorization:`token ${github_token}`}}).then(r=>r.json()).then(j=>j.object.sha);updateProgress();
	console.log(`latestCommitSha: ${JSON.stringify(latestCommitSha)}`);
	const blobData=await (async()=>{const a=[];let b=0;const c=[...listOfFiles],d=async()=>{if(0!==c.length||0!==b)for(;0<c.length&&b<5;){const e=c.shift();b++,(async()=>{try{if(null==e.content)a.push({path:e.path,mode:"100644",sha:null});else{const b=await fetch(`${apiUrl}/blobs`,{method:"POST",headers:{Authorization:`token ${github_token}`},body:JSON.stringify({content:e.content.split(";base64,").at(1),encoding:"base64"})});updateProgress();const c=await b.json();a.push(c)}}catch(b){console.error("Error fetching blob:",b),a.push({path:e.path,error:b.message})}finally{b--,d()}})()}};for(await d();0<b;)await new Promise(a=>setTimeout(a,100));return a})();
	console.log(`blobData: ${JSON.stringify(blobData)}`);
	const treeData=await fetch(`${apiUrl}/trees`,{method:'POST',headers:{Authorization:`token ${github_token}`},body:JSON.stringify({base_tree:latestCommitSha,tree:blobData.map((blob,index)=>({path:listOfFiles[index].path,mode:'100644',type:'blob',sha:blob.sha}))})}).then(r=>r.json());updateProgress();
	console.log(`treeData: ${JSON.stringify(treeData)}`);
	const commitData=await fetch(`${apiUrl}/commits`,{method:'POST',headers:{Authorization:`token ${github_token}`},body:JSON.stringify({message:`${listOfFiles.length} file(s) added/updated/removed by GitHub API`,tree:treeData.sha,parents:[latestCommitSha]})}).then(r=>r.json());updateProgress();
	console.log(`commitData: ${JSON.stringify(commitData)}`);
	const pushData=await fetch(`${apiUrl}/refs/heads/${refId}`,{method:'PATCH',headers:{Authorization:`token ${github_token}`},body:JSON.stringify({sha:commitData.sha})});updateProgress();
	console.log(`pushData: ${JSON.stringify(pushData)}`);
	gId('commit-backdrop').remove();
	return pushData
}
uploadFileInput.onchange=async(e)=>{
	const [locationId,refId]=window.location.hash.slice(1).split('?ref=');
	let veilStopwatch=0;
	gId('file-display').insertAdjacentHTML('afterend','<div id="commit-backdrop"></div>');

	// 1. Process picked files
	let filesToUpload = await Promise.all(Array.from(e.target.files).map(file=>{
		let reader=new FileReader();
		return new Promise(resolve=>{
			reader.onload=()=>{
				gId('commit-backdrop').textContent=`Processing files: ${Number(++veilStopwatch/e.target.files.length).toLocaleString(undefined,{style:'percent',minimumFractionDigits:2})}`;
				return resolve({content:reader.result,path:`${decodeURIComponent(locationId.slice(17+browsingCurrentRepo.length))}/${file.name}`})
			};
			reader.readAsDataURL(file)
		})
	}))
	gId('commit-backdrop').remove();

	uploadFileInput.value='';
	const updateRefResponse=await githubCommit(filesToUpload,browsingCurrentRepo,refId);

	if(updateRefResponse.ok){
		console.log('Commit successful');
		raiseToast(`${filesToUpload.length} file(s) has been uploaded`)
	}else{
		console.error('Error updating ref:', updateRefResponse.status, updateRefResponse.statusText);
		raiseToast(`Error updating reference`)
	}
	gId('explore-refresh').onclick();
}
gId('delete-item').onclick=async(gitUrl)=>{
	let [locationId, refId] = window.location.hash.slice(1).split('?ref=');
	const apiUrl = `https://api.github.com/repos/${browsingCurrentRepo}/git`;
	const currentPath = decodeURIComponent(locationId.slice(17+browsingCurrentRepo.length))

	// 1. Gather files via traversing the trees
	let currentGitUrl={sha:refId}
	for(let i=0;i<currentPath.split('/').length&&currentPath!=''; i++){
		currentGitUrl=await fetch(`${apiUrl}/trees/${currentGitUrl.sha}`,github_api_headers({refresh:true})).then(r=>r.json()).then(j=>j.tree.find(e=>e.path==currentPath.split('/').at(i)))
	}
	currentGitUrl=await fetch(`${apiUrl}/trees/${currentGitUrl.sha}?recursive=1`,github_api_headers({refresh:true})).then(r=>r.json()).then(j=>j.tree.filter(e=>e.type=='blob'))

	// 2. Get all files, including those from inside the folder
	const filesToDelete = [...document.querySelectorAll('#explore-content > .explore-cell:has(input[type="checkbox"]:checked)')].map(e=>
		e.getAttribute('data-type')=='tree'?currentGitUrl.filter(b=>b.path.startsWith(`${e.getAttribute('data-path')}/`)).map(b=>b.path):e.getAttribute('data-path')
	).flat().map(e=>{return {content: null, path: currentPath?`${currentPath}/${e}`:e}});

	// 3. Confirm deletion
	if(!confirm(`Delete ${filesToDelete.length} files from "${locationId}" (${refId})?`))return false;

	// 4. Commit
	const updateRefResponse=await githubCommit(filesToDelete,browsingCurrentRepo,refId);

	// 5. Response
	if(updateRefResponse.ok){
		console.log('Commit successful');
		raiseToast(`${filesToDelete.length} file(s) has been deleted`)
	}else{
		console.error('Error updating ref:', updateRefResponse.status, updateRefResponse.statusText);
		raiseToast(`Error updating ref`)
	}
	gId('explore-refresh').onclick();
}
gId('create-folder').onclick=async()=>{
	let folderName = prompt('New folder name')
	if(folderName!=null){
		let [locationId, refId] = window.location.hash.slice(1).split('?ref=');
		let uploadedFileURL = `https://api.github.com${locationId}/${folderName}/.gitkeep?ref=${refId}`;
		fetch(
			uploadedFileURL, {
			headers: {Authorization: `token ${github_token}`},
			method: 'PUT',
			body: JSON.stringify({
				message: `Create this folder with GitHub API at "${new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric',hour:'numeric',minute:'numeric',second:'numeric'})}"`,
				content: ''
			})
		})
		.then(r=>r.json())
		.then(j=>{
			gId('explore-refresh').onclick();
			raiseToast(`"${folderName}" folder has been created`)
		})
	}
}
gId('select-branch').onchange=e=>{
	browsingTree=browsingTree.map(v=>v.includes('?ref=')?`${v.split('?ref=',1)[0]}?ref=${e.target.value}`:v)
	window.location.href = `#${browsingTree.pop()}`
}
const searchContents=()=>{document.querySelectorAll('.explore-cell').forEach(function(a){a.style.display=(a.getAttribute('data-path').toLowerCase().includes(gId('search-input').value.toLowerCase()))?'':'none'})}
const github_signin=()=>{localStorage.setItem('github_login_last_page',window.location.href);window.location.href='https://github.com/login/oauth/authorize?client_id=Iv23liaWNIqsLBdsPiAY&redirect_uri=https://arialhamed.github.io/github/callback'}
const github_logout=()=>{localStorage.removeItem('github_token');window.location.reload()}

// GitHub display
gId('github-user-profile').insertAdjacentHTML('afterbegin', `<span style="max-width: 50%; text-align: left; float: left;">All done with <a href="https://api.github.com/" target="_blank">GitHub's API</a> (<a id="github-auth" onclick="${(github_token)?'github_logout()">log-out':'github_signin()">sign-in'}</a>).</span>`)

// Browsing controls
gId('back-to-start').onclick=()=>window.location.href=`#/users/${ghusr}/repos?per_page=100&sort=pushed`;
gId('explore-refresh').onclick=()=>window.onhashchange();
gId('create-file').onclick='';
gId('upload-file').onclick=()=>uploadFileInput.click();
gId('select-all').onclick=e=>{
	const allSelects=document.querySelectorAll('.explore-cell > input[type="checkbox"]');
	const allChecked=!Array.from(allSelects).every(f=>f.checked);
	allSelects.forEach(e=>e.checked=allChecked)
};
gId('download-repo').onclick=()=>downloadRepo();
gId('edit-description').onclick=()=>alert('"Edit description" function not available yet (WIP)');

// Kick off when the page loads, or go straight to a stated url
// If there is a query named 'url', the page will go to that and extend the browsingTree. fun fact: this is why that's not called browsingHistory :3 that is user dependant now
const qUrl=window.location.hash.substring(1);
if(!qUrl){
	console.log('Resetting to all-repo view')
	window.location.href=`#/users/${ghusr}/repos?per_page=100&sort=pushed`
}else{
	let tempCurrentRepo = qUrl.slice(7).split('/').slice(0,2).join('/'); // copy of browsingCurrentRepo (not initialized yet)

	// If you landed in the contents of a repository
	if(qUrl.includes('?ref=')){
		// And if you landed beyond the root directory of the contents of the repository
		if(!qUrl.slice(7+tempCurrentRepo.length).startsWith('/contents?ref=')){
			browsingTree.push(`/repos/${tempCurrentRepo}/contents`)

			// Take the iterative value at after a number of chars as:
			// '/repos/' = 7 chars
			// '{user}/{repository}' = tempCurrentRepo.length
			// '/contents/' = 10 chars
			let [iterative, refId] = qUrl.slice(17+tempCurrentRepo.length).split('?ref=')

			// Takes the last item in browsingTree and add the value that is looping through the iterative
			// Don't include the last item as that will be added in when it loads
			iterative.split('/').slice(0,-1).forEach(s=>{
				browsingTree.push(`${browsingTree.at(-1)}/${s}`)
			})

			// Add branch ID to all the links
			browsingTree=browsingTree.map(s=>`${s}?ref=${refId}`)
		}

		// Add all-repo view URL to the start of browsingTree for all times you land in the contents of a repository
		browsingTree.unshift(`/users/${ghusr}/repos?per_page=100&sort=pushed`);
	}
	window.onhashchange()
}
</script>